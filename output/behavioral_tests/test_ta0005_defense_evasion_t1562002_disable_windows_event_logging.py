import unittest

from internal.logtest import LogtestStatus, send_multiple_logs  # type: ignore


class TestTa0005DefenseEvasionT1562002DisableWindowsEventLogging(unittest.TestCase):

    def test_id33205_sql_server_audit_object_disabled(self) -> None:
        # Logs extracted from EVTX file
        logs = [
            r'''{"win": {"system": {"providerName": "MSSQL$RADAR", "providerGuid": {"@Name": "MSSQL$RADAR"}, "eventID": "33205", "level": "0", "task": "5", "keywords": "0xa0000000000000", "systemTime": "2020-11-24T09:07:39.5608406Z", "eventRecordID": "113171", "channel": "Application", "computer": "mssql01.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Failed to get metadata for provider MSSQL$RADAR)"}, "eventdata": {}}}''',
            r'''{"win": {"system": {"providerName": "MSSQL$RADAR", "providerGuid": {"@Name": "MSSQL$RADAR"}, "eventID": "33205", "level": "0", "task": "5", "keywords": "0xa0000000000000", "systemTime": "2020-11-24T09:07:39.5608406Z", "eventRecordID": "113172", "channel": "Application", "computer": "mssql01.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Failed to get metadata for provider MSSQL$RADAR)"}, "eventdata": {}}}''',
            r'''{"win": {"system": {"providerName": "MSSQL$RADAR", "providerGuid": {"@Name": "MSSQL$RADAR"}, "eventID": "33205", "level": "0", "task": "4", "keywords": "0xa0000000000000", "systemTime": "2020-11-24T09:07:40.6722774Z", "eventRecordID": "113173", "channel": "Application", "computer": "mssql01.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Failed to get metadata for provider MSSQL$RADAR)"}, "eventdata": {}}}''',
            r'''{"win": {"system": {"providerName": "MSSQL$RADAR", "providerGuid": {"@Name": "MSSQL$RADAR"}, "eventID": "33205", "level": "0", "task": "5", "keywords": "0xa0000000000000", "systemTime": "2020-11-24T09:07:40.6722774Z", "eventRecordID": "113174", "channel": "Application", "computer": "mssql01.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Failed to get metadata for provider MSSQL$RADAR)"}, "eventdata": {}}}'''
        ]

        responses = send_multiple_logs(logs, location="stdin", log_format="json")

        # Ensure we receive a response for each log sent
        self.assertEqual(len(responses), len(logs))

        for _, response in enumerate(responses):
            self.assertEqual(response.status, LogtestStatus.RuleMatch)
            self.assertEqual(response.decoder, 'json')

            # Example: Set expected Wazuh rule ID and level when analyzing logs
            # expected_rule_id = None  # Replace with actual rule ID
            # expected_rule_level = None  # Replace with actual rule level

            # self.assertEqual(response.rule_id, expected_rule_id)
            # self.assertEqual(response.rule_level, expected_rule_level)

        # TODO: Write the expected result as test cases when the logs are analyzed by Wazuh.
        self.fail("Test not implemented yet. Define expected results.")

    def test_id33205_sql_server_audit_object_deleted(self) -> None:
        # Logs extracted from EVTX file
        logs = [
            r'''{"win": {"system": {"providerName": "MSSQL$RADAR", "providerGuid": {"@Name": "MSSQL$RADAR"}, "eventID": "33205", "level": "0", "task": "5", "keywords": "0xa0000000000000", "systemTime": "2020-11-24T09:09:34.2311305Z", "eventRecordID": "113180", "channel": "Application", "computer": "mssql01.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Failed to get metadata for provider MSSQL$RADAR)"}, "eventdata": {}}}''',
            r'''{"win": {"system": {"providerName": "MSSQL$RADAR", "providerGuid": {"@Name": "MSSQL$RADAR"}, "eventID": "33205", "level": "0", "task": "5", "keywords": "0xa0000000000000", "systemTime": "2020-11-24T09:09:34.2467357Z", "eventRecordID": "113181", "channel": "Application", "computer": "mssql01.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Failed to get metadata for provider MSSQL$RADAR)"}, "eventdata": {}}}''',
            r'''{"win": {"system": {"providerName": "MSSQL$RADAR", "providerGuid": {"@Name": "MSSQL$RADAR"}, "eventID": "33205", "level": "0", "task": "5", "keywords": "0xa0000000000000", "systemTime": "2020-11-24T09:09:35.8161343Z", "eventRecordID": "113182", "channel": "Application", "computer": "mssql01.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Failed to get metadata for provider MSSQL$RADAR)"}, "eventdata": {}}}''',
            r'''{"win": {"system": {"providerName": "MSSQL$RADAR", "providerGuid": {"@Name": "MSSQL$RADAR"}, "eventID": "33205", "level": "0", "task": "5", "keywords": "0xa0000000000000", "systemTime": "2020-11-24T09:09:35.8161343Z", "eventRecordID": "113183", "channel": "Application", "computer": "mssql01.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Failed to get metadata for provider MSSQL$RADAR)"}, "eventdata": {}}}'''
        ]

        responses = send_multiple_logs(logs, location="stdin", log_format="json")

        # Ensure we receive a response for each log sent
        self.assertEqual(len(responses), len(logs))

        for _, response in enumerate(responses):
            self.assertEqual(response.status, LogtestStatus.RuleMatch)
            self.assertEqual(response.decoder, 'json')

            # Example: Set expected Wazuh rule ID and level when analyzing logs
            # expected_rule_id = None  # Replace with actual rule ID
            # expected_rule_level = None  # Replace with actual rule level

            # self.assertEqual(response.rule_id, expected_rule_id)
            # self.assertEqual(response.rule_level, expected_rule_level)

        # TODO: Write the expected result as test cases when the logs are analyzed by Wazuh.
        self.fail("Test not implemented yet. Define expected results.")

    def test_id33205_sql_server_audit_specification_deleted(self) -> None:
        # Logs extracted from EVTX file
        logs = [
            r'''{"win": {"system": {"providerName": "MSSQL$RADAR", "providerGuid": {"@Name": "MSSQL$RADAR"}, "eventID": "33205", "level": "0", "task": "5", "keywords": "0xa0000000000000", "systemTime": "2020-11-24T09:06:55.6043304Z", "eventRecordID": "113161", "channel": "Application", "computer": "mssql01.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Failed to get metadata for provider MSSQL$RADAR)"}, "eventdata": {}}}''',
            r'''{"win": {"system": {"providerName": "MSSQL$RADAR", "providerGuid": {"@Name": "MSSQL$RADAR"}, "eventID": "33205", "level": "0", "task": "5", "keywords": "0xa0000000000000", "systemTime": "2020-11-24T09:06:55.6043304Z", "eventRecordID": "113162", "channel": "Application", "computer": "mssql01.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Failed to get metadata for provider MSSQL$RADAR)"}, "eventdata": {}}}'''
        ]

        responses = send_multiple_logs(logs, location="stdin", log_format="json")

        # Ensure we receive a response for each log sent
        self.assertEqual(len(responses), len(logs))

        for _, response in enumerate(responses):
            self.assertEqual(response.status, LogtestStatus.RuleMatch)
            self.assertEqual(response.decoder, 'json')

            # Example: Set expected Wazuh rule ID and level when analyzing logs
            # expected_rule_id = None  # Replace with actual rule ID
            # expected_rule_level = None  # Replace with actual rule level

            # self.assertEqual(response.rule_id, expected_rule_id)
            # self.assertEqual(response.rule_level, expected_rule_level)

        # TODO: Write the expected result as test cases when the logs are analyzed by Wazuh.
        self.fail("Test not implemented yet. Define expected results.")

    def test_id33205_sql_server_audit_specification_disabled(self) -> None:
        # Logs extracted from EVTX file
        logs = [
            r'''{"win": {"system": {"providerName": "MSSQL$RADAR", "providerGuid": {"@Name": "MSSQL$RADAR"}, "eventID": "33205", "level": "0", "task": "4", "keywords": "0xa0000000000000", "systemTime": "2020-11-24T09:05:45.4921322Z", "eventRecordID": "113155", "channel": "Application", "computer": "mssql01.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Failed to get metadata for provider MSSQL$RADAR)"}, "eventdata": {}}}''',
            r'''{"win": {"system": {"providerName": "MSSQL$RADAR", "providerGuid": {"@Name": "MSSQL$RADAR"}, "eventID": "33205", "level": "0", "task": "5", "keywords": "0xa0000000000000", "systemTime": "2020-11-24T09:05:45.4921322Z", "eventRecordID": "113156", "channel": "Application", "computer": "mssql01.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Failed to get metadata for provider MSSQL$RADAR)"}, "eventdata": {}}}'''
        ]

        responses = send_multiple_logs(logs, location="stdin", log_format="json")

        # Ensure we receive a response for each log sent
        self.assertEqual(len(responses), len(logs))

        for _, response in enumerate(responses):
            self.assertEqual(response.status, LogtestStatus.RuleMatch)
            self.assertEqual(response.decoder, 'json')

            # Example: Set expected Wazuh rule ID and level when analyzing logs
            # expected_rule_id = None  # Replace with actual rule ID
            # expected_rule_level = None  # Replace with actual rule level

            # self.assertEqual(response.rule_id, expected_rule_id)
            # self.assertEqual(response.rule_level, expected_rule_level)

        # TODO: Write the expected result as test cases when the logs are analyzed by Wazuh.
        self.fail("Test not implemented yet. Define expected results.")

    def test_id33205_sql_server_database_audit_specification_deleted(self) -> None:
        # Logs extracted from EVTX file
        logs = [
            r'''{"win": {"system": {"providerName": "MSSQL$RADAR", "providerGuid": {"@Name": "MSSQL$RADAR"}, "eventID": "33205", "level": "0", "task": "4", "keywords": "0xa0000000000000", "systemTime": "2020-11-24T09:14:11.1676976Z", "eventRecordID": "113200", "channel": "Application", "computer": "mssql01.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Failed to get metadata for provider MSSQL$RADAR)"}, "eventdata": {}}}''',
            r'''{"win": {"system": {"providerName": "MSSQL$RADAR", "providerGuid": {"@Name": "MSSQL$RADAR"}, "eventID": "33205", "level": "0", "task": "4", "keywords": "0xa0000000000000", "systemTime": "2020-11-24T09:14:11.1676976Z", "eventRecordID": "113201", "channel": "Application", "computer": "mssql01.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Failed to get metadata for provider MSSQL$RADAR)"}, "eventdata": {}}}''',
            r'''{"win": {"system": {"providerName": "MSSQL$RADAR", "providerGuid": {"@Name": "MSSQL$RADAR"}, "eventID": "33205", "level": "0", "task": "5", "keywords": "0xa0000000000000", "systemTime": "2020-11-24T09:14:16.1677903Z", "eventRecordID": "113202", "channel": "Application", "computer": "mssql01.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Failed to get metadata for provider MSSQL$RADAR)"}, "eventdata": {}}}''',
            r'''{"win": {"system": {"providerName": "MSSQL$RADAR", "providerGuid": {"@Name": "MSSQL$RADAR"}, "eventID": "33205", "level": "0", "task": "5", "keywords": "0xa0000000000000", "systemTime": "2020-11-24T09:14:16.1677903Z", "eventRecordID": "113203", "channel": "Application", "computer": "mssql01.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Failed to get metadata for provider MSSQL$RADAR)"}, "eventdata": {}}}'''
        ]

        responses = send_multiple_logs(logs, location="stdin", log_format="json")

        # Ensure we receive a response for each log sent
        self.assertEqual(len(responses), len(logs))

        for _, response in enumerate(responses):
            self.assertEqual(response.status, LogtestStatus.RuleMatch)
            self.assertEqual(response.decoder, 'json')

            # Example: Set expected Wazuh rule ID and level when analyzing logs
            # expected_rule_id = None  # Replace with actual rule ID
            # expected_rule_level = None  # Replace with actual rule level

            # self.assertEqual(response.rule_id, expected_rule_id)
            # self.assertEqual(response.rule_level, expected_rule_level)

        # TODO: Write the expected result as test cases when the logs are analyzed by Wazuh.
        self.fail("Test not implemented yet. Define expected results.")

    def test_id33205_sql_server_database_audit_specification_disabled(self) -> None:
        # Logs extracted from EVTX file
        logs = [
            r'''{"win": {"system": {"providerName": "MSSQL$RADAR", "providerGuid": {"@Name": "MSSQL$RADAR"}, "eventID": "33205", "level": "0", "task": "4", "keywords": "0xa0000000000000", "systemTime": "2020-11-24T09:13:26.0945208Z", "eventRecordID": "113196", "channel": "Application", "computer": "mssql01.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Failed to get metadata for provider MSSQL$RADAR)"}, "eventdata": {}}}''',
            r'''{"win": {"system": {"providerName": "MSSQL$RADAR", "providerGuid": {"@Name": "MSSQL$RADAR"}, "eventID": "33205", "level": "0", "task": "5", "keywords": "0xa0000000000000", "systemTime": "2020-11-24T09:13:26.0945208Z", "eventRecordID": "113197", "channel": "Application", "computer": "mssql01.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Failed to get metadata for provider MSSQL$RADAR)"}, "eventdata": {}}}'''
        ]

        responses = send_multiple_logs(logs, location="stdin", log_format="json")

        # Ensure we receive a response for each log sent
        self.assertEqual(len(responses), len(logs))

        for _, response in enumerate(responses):
            self.assertEqual(response.status, LogtestStatus.RuleMatch)
            self.assertEqual(response.decoder, 'json')

            # Example: Set expected Wazuh rule ID and level when analyzing logs
            # expected_rule_id = None  # Replace with actual rule ID
            # expected_rule_level = None  # Replace with actual rule level

            # self.assertEqual(response.rule_id, expected_rule_id)
            # self.assertEqual(response.rule_level, expected_rule_level)

        # TODO: Write the expected result as test cases when the logs are analyzed by Wazuh.
        self.fail("Test not implemented yet. Define expected results.")

    def test_id4688_audit_policy_clear_attempt(self) -> None:
        # Logs extracted from EVTX file
        logs = [
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4688", "version": "2", "level": "0", "task": "13312", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2020-07-09T20:09:33.7890046Z", "eventRecordID": "1149199", "processID": "4", "threadID": "1968", "channel": "Security", "computer": "fs02.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "A new process has been created.\n\nCreator Subject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1158\n\tAccount Name:\t\tlambda-user\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x20557C5\n\nTarget Subject:\n\tSecurity ID:\t\tS-1-0-0\n\tAccount Name:\t\t-\n\tAccount Domain:\t\t-\n\tLogon ID:\t\t0x0\n\nProcess Information:\n\tNew Process ID:\t\t0x978\n\tNew Process Name:\tC:\\Windows\\System32\\auditpol.exe\n\tToken Elevation Type:\t%%1936\n\tMandatory Label:\t\t%15\n\tCreator Process ID:\t%8\n\tCreator Process Name:\t%14!S!\n\tProcess Command Line:\t%9!S!\n\nToken Elevation Type indicates the type of token that was assigned to the new process in accordance with User Account Control policy.\n\nType 1 is a full token with no privileges removed or groups disabled.  A full token is only used if User Account Control is disabled or if the user is the built-in Administrator account or a service account.\n\nType 2 is an elevated token with no privileges removed or groups disabled.  An elevated token is used when User Account Control is enabled and the user chooses to start the program using Run as administrator.  An elevated token is also used when an application is configured to always require administrative privilege or to always require maximum privilege, and the user is a member of the Administrators group.\n\nType 3 is a limited token with administrative privileges removed and administrative groups disabled.  The limited token is used when User Account Control is enabled, the application does not require administrative privilege, and the user does not choose to start the program using Run as administrator."}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1158", "subjectUserName": "lambda-user", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x20557c5", "newProcessId": "0x978", "newProcessName": "C:\\Windows\\System32\\auditpol.exe", "tokenElevationType": "%%1936", "processId": "0x8bc", "commandLine": "\"C:\\Windows\\system32\\auditpol.exe\"  /clear /y", "targetUserSid": "S-1-0-0", "targetLogonId": "0x0"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4688", "version": "2", "level": "0", "task": "13312", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2020-07-09T20:09:33.7890046Z", "eventRecordID": "1149200", "processID": "4", "threadID": "1968", "channel": "Security", "computer": "fs02.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "A new process has been created.\n\nCreator Subject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1158\n\tAccount Name:\t\tlambda-user\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x20557C5\n\nTarget Subject:\n\tSecurity ID:\t\tS-1-0-0\n\tAccount Name:\t\t-\n\tAccount Domain:\t\t-\n\tLogon ID:\t\t0x0\n\nProcess Information:\n\tNew Process ID:\t\t0x5b4\n\tNew Process Name:\tC:\\Windows\\System32\\conhost.exe\n\tToken Elevation Type:\t%%1936\n\tMandatory Label:\t\t%15\n\tCreator Process ID:\t%8\n\tCreator Process Name:\t%14!S!\n\tProcess Command Line:\t%9!S!\n\nToken Elevation Type indicates the type of token that was assigned to the new process in accordance with User Account Control policy.\n\nType 1 is a full token with no privileges removed or groups disabled.  A full token is only used if User Account Control is disabled or if the user is the built-in Administrator account or a service account.\n\nType 2 is an elevated token with no privileges removed or groups disabled.  An elevated token is used when User Account Control is enabled and the user chooses to start the program using Run as administrator.  An elevated token is also used when an application is configured to always require administrative privilege or to always require maximum privilege, and the user is a member of the Administrators group.\n\nType 3 is a limited token with administrative privileges removed and administrative groups disabled.  The limited token is used when User Account Control is enabled, the application does not require administrative privilege, and the user does not choose to start the program using Run as administrator."}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1158", "subjectUserName": "lambda-user", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x20557c5", "newProcessId": "0x5b4", "newProcessName": "C:\\Windows\\System32\\conhost.exe", "tokenElevationType": "%%1936", "processId": "0x978", "commandLine": "\\??\\C:\\Windows\\system32\\conhost.exe 0xffffffff", "targetUserSid": "S-1-0-0", "targetLogonId": "0x0"}}}'''
        ]

        responses = send_multiple_logs(logs, location="stdin", log_format="json")

        # Ensure we receive a response for each log sent
        self.assertEqual(len(responses), len(logs))

        for _, response in enumerate(responses):
            self.assertEqual(response.status, LogtestStatus.RuleMatch)
            self.assertEqual(response.decoder, 'json')

            # Example: Set expected Wazuh rule ID and level when analyzing logs
            # expected_rule_id = None  # Replace with actual rule ID
            # expected_rule_level = None  # Replace with actual rule level

            # self.assertEqual(response.rule_id, expected_rule_id)
            # self.assertEqual(response.rule_level, expected_rule_level)

        # TODO: Write the expected result as test cases when the logs are analyzed by Wazuh.
        self.fail("Test not implemented yet. Define expected results.")

    def test_id4688_audit_policy_deactivation_attempt(self) -> None:
        # Logs extracted from EVTX file
        logs = [
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4688", "version": "2", "level": "0", "task": "13312", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2020-07-09T20:07:58.8587097Z", "eventRecordID": "1148813", "processID": "4", "threadID": "2340", "channel": "Security", "computer": "fs02.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "A new process has been created.\n\nCreator Subject:\n\tSecurity ID:\t\tS-1-5-18\n\tAccount Name:\t\tFS02$\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x3E7\n\nTarget Subject:\n\tSecurity ID:\t\tS-1-0-0\n\tAccount Name:\t\t-\n\tAccount Domain:\t\t-\n\tLogon ID:\t\t0x0\n\nProcess Information:\n\tNew Process ID:\t\t0x108\n\tNew Process Name:\tC:\\Windows\\System32\\taskhostex.exe\n\tToken Elevation Type:\t%%1936\n\tMandatory Label:\t\t%15\n\tCreator Process ID:\t%8\n\tCreator Process Name:\t%14!S!\n\tProcess Command Line:\t%9!S!\n\nToken Elevation Type indicates the type of token that was assigned to the new process in accordance with User Account Control policy.\n\nType 1 is a full token with no privileges removed or groups disabled.  A full token is only used if User Account Control is disabled or if the user is the built-in Administrator account or a service account.\n\nType 2 is an elevated token with no privileges removed or groups disabled.  An elevated token is used when User Account Control is enabled and the user chooses to start the program using Run as administrator.  An elevated token is also used when an application is configured to always require administrative privilege or to always require maximum privilege, and the user is a member of the Administrators group.\n\nType 3 is a limited token with administrative privileges removed and administrative groups disabled.  The limited token is used when User Account Control is enabled, the application does not require administrative privilege, and the user does not choose to start the program using Run as administrator."}, "eventdata": {"subjectUserSid": "S-1-5-18", "subjectUserName": "FS02$", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x3e7", "newProcessId": "0x108", "newProcessName": "C:\\Windows\\System32\\taskhostex.exe", "tokenElevationType": "%%1936", "processId": "0x2dc", "commandLine": "taskhostex.exe", "targetUserSid": "S-1-0-0", "targetLogonId": "0x0"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4688", "version": "2", "level": "0", "task": "13312", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2020-07-09T20:08:00.4633720Z", "eventRecordID": "1148819", "processID": "4", "threadID": "2340", "channel": "Security", "computer": "fs02.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "A new process has been created.\n\nCreator Subject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1158\n\tAccount Name:\t\tlambda-user\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x20557C5\n\nTarget Subject:\n\tSecurity ID:\t\tS-1-0-0\n\tAccount Name:\t\t-\n\tAccount Domain:\t\t-\n\tLogon ID:\t\t0x0\n\nProcess Information:\n\tNew Process ID:\t\t0x900\n\tNew Process Name:\tC:\\Windows\\System32\\auditpol.exe\n\tToken Elevation Type:\t%%1936\n\tMandatory Label:\t\t%15\n\tCreator Process ID:\t%8\n\tCreator Process Name:\t%14!S!\n\tProcess Command Line:\t%9!S!\n\nToken Elevation Type indicates the type of token that was assigned to the new process in accordance with User Account Control policy.\n\nType 1 is a full token with no privileges removed or groups disabled.  A full token is only used if User Account Control is disabled or if the user is the built-in Administrator account or a service account.\n\nType 2 is an elevated token with no privileges removed or groups disabled.  An elevated token is used when User Account Control is enabled and the user chooses to start the program using Run as administrator.  An elevated token is also used when an application is configured to always require administrative privilege or to always require maximum privilege, and the user is a member of the Administrators group.\n\nType 3 is a limited token with administrative privileges removed and administrative groups disabled.  The limited token is used when User Account Control is enabled, the application does not require administrative privilege, and the user does not choose to start the program using Run as administrator."}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1158", "subjectUserName": "lambda-user", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x20557c5", "newProcessId": "0x900", "newProcessName": "C:\\Windows\\System32\\auditpol.exe", "tokenElevationType": "%%1936", "processId": "0x8bc", "commandLine": "\"C:\\Windows\\system32\\auditpol.exe\"  /set /category:* /success:disable /failure:disable", "targetUserSid": "S-1-0-0", "targetLogonId": "0x0"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4688", "version": "2", "level": "0", "task": "13312", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2020-07-09T20:08:00.4790102Z", "eventRecordID": "1148820", "processID": "4", "threadID": "2340", "channel": "Security", "computer": "fs02.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "A new process has been created.\n\nCreator Subject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1158\n\tAccount Name:\t\tlambda-user\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x20557C5\n\nTarget Subject:\n\tSecurity ID:\t\tS-1-0-0\n\tAccount Name:\t\t-\n\tAccount Domain:\t\t-\n\tLogon ID:\t\t0x0\n\nProcess Information:\n\tNew Process ID:\t\t0x258\n\tNew Process Name:\tC:\\Windows\\System32\\conhost.exe\n\tToken Elevation Type:\t%%1936\n\tMandatory Label:\t\t%15\n\tCreator Process ID:\t%8\n\tCreator Process Name:\t%14!S!\n\tProcess Command Line:\t%9!S!\n\nToken Elevation Type indicates the type of token that was assigned to the new process in accordance with User Account Control policy.\n\nType 1 is a full token with no privileges removed or groups disabled.  A full token is only used if User Account Control is disabled or if the user is the built-in Administrator account or a service account.\n\nType 2 is an elevated token with no privileges removed or groups disabled.  An elevated token is used when User Account Control is enabled and the user chooses to start the program using Run as administrator.  An elevated token is also used when an application is configured to always require administrative privilege or to always require maximum privilege, and the user is a member of the Administrators group.\n\nType 3 is a limited token with administrative privileges removed and administrative groups disabled.  The limited token is used when User Account Control is enabled, the application does not require administrative privilege, and the user does not choose to start the program using Run as administrator."}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1158", "subjectUserName": "lambda-user", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x20557c5", "newProcessId": "0x258", "newProcessName": "C:\\Windows\\System32\\conhost.exe", "tokenElevationType": "%%1936", "processId": "0x900", "commandLine": "\\??\\C:\\Windows\\system32\\conhost.exe 0xffffffff", "targetUserSid": "S-1-0-0", "targetLogonId": "0x0"}}}'''
        ]

        responses = send_multiple_logs(logs, location="stdin", log_format="json")

        # Ensure we receive a response for each log sent
        self.assertEqual(len(responses), len(logs))

        for _, response in enumerate(responses):
            self.assertEqual(response.status, LogtestStatus.RuleMatch)
            self.assertEqual(response.decoder, 'json')

            # Example: Set expected Wazuh rule ID and level when analyzing logs
            # expected_rule_id = None  # Replace with actual rule ID
            # expected_rule_level = None  # Replace with actual rule level

            # self.assertEqual(response.rule_id, expected_rule_id)
            # self.assertEqual(response.rule_level, expected_rule_level)

        # TODO: Write the expected result as test cases when the logs are analyzed by Wazuh.
        self.fail("Test not implemented yet. Define expected results.")

    def test_id4719_audit_policy_deactivation(self) -> None:
        # Logs extracted from EVTX file
        logs = [
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109446", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tSystem\n\tSubcategory:\t\tSecurity State Change\n\tSubcategory GUID:\t{0cce9210-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8272", "subcategoryId": "%%12288", "subcategoryGuid": "{0cce9210-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109447", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tSystem\n\tSubcategory:\t\tSecurity System Extension\n\tSubcategory GUID:\t{0cce9211-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8272", "subcategoryId": "%%12289", "subcategoryGuid": "{0cce9211-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109448", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tSystem\n\tSubcategory:\t\tSystem Integrity\n\tSubcategory GUID:\t{0cce9212-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8272", "subcategoryId": "%%12290", "subcategoryGuid": "{0cce9212-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109449", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tSystem\n\tSubcategory:\t\tOther System Events\n\tSubcategory GUID:\t{0cce9214-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8272", "subcategoryId": "%%12292", "subcategoryGuid": "{0cce9214-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109450", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tLogon/Logoff\n\tSubcategory:\t\tLogon\n\tSubcategory GUID:\t{0cce9215-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8273", "subcategoryId": "%%12544", "subcategoryGuid": "{0cce9215-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109451", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tLogon/Logoff\n\tSubcategory:\t\tAccount Lockout\n\tSubcategory GUID:\t{0cce9217-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8273", "subcategoryId": "%%12546", "subcategoryGuid": "{0cce9217-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109452", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tLogon/Logoff\n\tSubcategory:\t\tSpecial Logon\n\tSubcategory GUID:\t{0cce921b-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8273", "subcategoryId": "%%12548", "subcategoryGuid": "{0cce921b-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109453", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tLogon/Logoff\n\tSubcategory:\t\tOther Logon/Logoff Events\n\tSubcategory GUID:\t{0cce921c-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8273", "subcategoryId": "%%12551", "subcategoryGuid": "{0cce921c-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109454", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tObject Access\n\tSubcategory:\t\tFile System\n\tSubcategory GUID:\t{0cce921d-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8274", "subcategoryId": "%%12800", "subcategoryGuid": "{0cce921d-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109455", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tObject Access\n\tSubcategory:\t\tRegistry\n\tSubcategory GUID:\t{0cce921e-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8274", "subcategoryId": "%%12801", "subcategoryGuid": "{0cce921e-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109456", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tObject Access\n\tSubcategory:\t\tKernel Object\n\tSubcategory GUID:\t{0cce921f-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8274", "subcategoryId": "%%12802", "subcategoryGuid": "{0cce921f-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109457", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tObject Access\n\tSubcategory:\t\tSAM\n\tSubcategory GUID:\t{0cce9220-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8274", "subcategoryId": "%%12803", "subcategoryGuid": "{0cce9220-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109458", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tObject Access\n\tSubcategory:\t\tOther Object Access Events\n\tSubcategory GUID:\t{0cce9227-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8274", "subcategoryId": "%%12804", "subcategoryGuid": "{0cce9227-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109459", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tObject Access\n\tSubcategory:\t\tHandle Manipulation\n\tSubcategory GUID:\t{0cce9223-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8274", "subcategoryId": "%%12807", "subcategoryGuid": "{0cce9223-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109460", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tObject Access\n\tSubcategory:\t\tFile Share\n\tSubcategory GUID:\t{0cce9224-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8274", "subcategoryId": "%%12808", "subcategoryGuid": "{0cce9224-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109461", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tObject Access\n\tSubcategory:\t\tDetailed File Share\n\tSubcategory GUID:\t{0cce9244-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8274", "subcategoryId": "%%12811", "subcategoryGuid": "{0cce9244-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109462", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tPrivilege Use\n\tSubcategory:\t\tSensitive Privilege Use\n\tSubcategory GUID:\t{0cce9228-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8275", "subcategoryId": "%%13056", "subcategoryGuid": "{0cce9228-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109463", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tDetailed Tracking\n\tSubcategory:\t\tProcess Creation\n\tSubcategory GUID:\t{0cce922b-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8276", "subcategoryId": "%%13312", "subcategoryGuid": "{0cce922b-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109464", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tDetailed Tracking\n\tSubcategory:\t\tPlug and Play Events\n\tSubcategory GUID:\t{0cce9248-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8276", "subcategoryId": "%%13316", "subcategoryGuid": "{0cce9248-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109465", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tPolicy Change\n\tSubcategory:\t\tAudit Policy Change\n\tSubcategory GUID:\t{0cce922f-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8277", "subcategoryId": "%%13568", "subcategoryGuid": "{0cce922f-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109466", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tPolicy Change\n\tSubcategory:\t\tAuthentication Policy Change\n\tSubcategory GUID:\t{0cce9230-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8277", "subcategoryId": "%%13569", "subcategoryGuid": "{0cce9230-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109467", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tPolicy Change\n\tSubcategory:\t\tAuthorization Policy Change\n\tSubcategory GUID:\t{0cce9231-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8277", "subcategoryId": "%%13570", "subcategoryGuid": "{0cce9231-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109468", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tPolicy Change\n\tSubcategory:\t\tMPSSVC Rule-Level Policy Change\n\tSubcategory GUID:\t{0cce9232-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8277", "subcategoryId": "%%13571", "subcategoryGuid": "{0cce9232-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109469", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tPolicy Change\n\tSubcategory:\t\tOther Policy Change Events\n\tSubcategory GUID:\t{0cce9234-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8277", "subcategoryId": "%%13573", "subcategoryGuid": "{0cce9234-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109470", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tAccount Management\n\tSubcategory:\t\tUser Account Management\n\tSubcategory GUID:\t{0cce9235-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8278", "subcategoryId": "%%13824", "subcategoryGuid": "{0cce9235-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109471", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tAccount Management\n\tSubcategory:\t\tComputer Account Management\n\tSubcategory GUID:\t{0cce9236-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8278", "subcategoryId": "%%13825", "subcategoryGuid": "{0cce9236-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109472", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tAccount Management\n\tSubcategory:\t\tSecurity Group Management\n\tSubcategory GUID:\t{0cce9237-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8278", "subcategoryId": "%%13826", "subcategoryGuid": "{0cce9237-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109473", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tAccount Management\n\tSubcategory:\t\tOther Account Management Events\n\tSubcategory GUID:\t{0cce923a-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8278", "subcategoryId": "%%13829", "subcategoryGuid": "{0cce923a-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109474", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tAccount Logon\n\tSubcategory:\t\tCredential Validation\n\tSubcategory GUID:\t{0cce923f-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8280", "subcategoryId": "%%14336", "subcategoryGuid": "{0cce923f-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4719", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-10-25T18:30:36.5159063Z", "eventRecordID": "109475", "processID": "492", "threadID": "2872", "channel": "Security", "computer": "FS03.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "System audit policy was changed.\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x123550\n\nAudit Policy Change:\n\tCategory:\t\tAccount Logon\n\tSubcategory:\t\tOther Account Logon Events\n\tSubcategory GUID:\t{0cce9241-69ae-11d9-bed3-505054503030}\n\tChanges:\t\tSuccess removed, Failure removed"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x123550", "categoryId": "%%8280", "subcategoryId": "%%14338", "subcategoryGuid": "{0cce9241-69ae-11d9-bed3-505054503030}", "auditPolicyChanges": "%%8448, %%8450"}}}'''
        ]

        responses = send_multiple_logs(logs, location="stdin", log_format="json")

        # Ensure we receive a response for each log sent
        self.assertEqual(len(responses), len(logs))

        for _, response in enumerate(responses):
            self.assertEqual(response.status, LogtestStatus.RuleMatch)
            self.assertEqual(response.decoder, 'json')

            # Example: Set expected Wazuh rule ID and level when analyzing logs
            # expected_rule_id = None  # Replace with actual rule ID
            # expected_rule_level = None  # Replace with actual rule level

            # self.assertEqual(response.rule_id, expected_rule_id)
            # self.assertEqual(response.rule_level, expected_rule_level)

        # TODO: Write the expected result as test cases when the logs are analyzed by Wazuh.
        self.fail("Test not implemented yet. Define expected results.")

    def test_id4739_domain_policy_changed_by_non_system_account(self) -> None:
        # Logs extracted from EVTX file
        logs = [
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4739", "version": "0", "level": "0", "task": "13569", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2020-08-02T11:04:58.0745235Z", "eventRecordID": "24468054", "processID": "516", "threadID": "5264", "channel": "Security", "computer": "rootdc1.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Domain Policy was changed.\n\nChange Type:\t\t- modified\n\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x11AE95BF\n\nDomain:\n\tDomain Name:\t\tOFFSEC\n\tDomain ID:\t\tS-1-5-21-4230534742-2542757381-3142984815\n\nChanged Attributes:\n\tMin. Password Age:\t-\n\tMax. Password Age:\t-\n\tForce Logoff:\t\t-\n\tLockout Threshold:\t-\n\tLockout Observation Window:\t-\n\tLockout Duration:\t-\n\tPassword Properties:\t-\n\tMin. Password Length:\t-\n\tPassword History Length:\t-\n\tMachine Account Quota:\t-\n\tMixed Domain Mode:\t-\n\tDomain Behavior Version:\t-\n\tOEM Information:\t-\n\nAdditional Information:\n\tPrivileges:\t\t-"}, "eventdata": {"domainName": "OFFSEC", "domainSid": "S-1-5-21-4230534742-2542757381-3142984815", "subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x11ae95bf"}}}'''
        ]

        responses = send_multiple_logs(logs, location="stdin", log_format="json")

        # Ensure we receive a response for each log sent
        self.assertEqual(len(responses), len(logs))

        for _, response in enumerate(responses):
            self.assertEqual(response.status, LogtestStatus.RuleMatch)
            self.assertEqual(response.decoder, 'json')

            # Example: Set expected Wazuh rule ID and level when analyzing logs
            # expected_rule_id = None  # Replace with actual rule ID
            # expected_rule_level = None  # Replace with actual rule level

            # self.assertEqual(response.rule_id, expected_rule_id)
            # self.assertEqual(response.rule_level, expected_rule_level)

        # TODO: Write the expected result as test cases when the logs are analyzed by Wazuh.
        self.fail("Test not implemented yet. Define expected results.")

    def test_id48854876487751235124_adcs_pki_ocsp(self) -> None:
        # Logs extracted from EVTX file
        logs = [
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "5124", "version": "0", "level": "0", "task": "12805", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2024-09-03T07:46:42.8200094Z", "eventRecordID": "375285", "processID": "640", "threadID": "1192", "channel": "Security", "computer": "CDCWPKI01.rootblue.lan", "severityValue": "AUDIT_SUCCESS", "message": "A security setting was updated on OCSP Responder Service.\n\nNew Value:\t\nAllow(0x00000101)\tBUILTIN\\Administrators\n\tOCSP Administrator\n\tRead\nAllow(0x00000101)\tROOTBLUE\\Cloneable Domain Controllers\n\tOCSP Administrator\n\tRead\nAllow(0x00000300)\tIIS APPPOOL\\OCSPISAPIAppPool\n\tRead\n\tOCSP Requestor"}, "eventdata": {"newSecuritySettings": "Allow(0x00000101)\tBUILTIN\\Administrators\n\tOCSP Administrator\n\tRead\nAllow(0x00000101)\tROOTBLUE\\Cloneable Domain Controllers\n\tOCSP Administrator\n\tRead\nAllow(0x00000300)\tIIS APPPOOL\\OCSPISAPIAppPool\n\tRead\n\tOCSP Requestor", "subjectUserSid": "S-1-5-21-392370121-190461309-2151315433-1108", "subjectUserName": "domadm", "subjectDomainName": "ROOTBLUE", "subjectLogonId": "0x91861a6"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "5124", "version": "0", "level": "0", "task": "12805", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2024-09-03T07:47:40.1324990Z", "eventRecordID": "375291", "processID": "640", "threadID": "5752", "channel": "Security", "computer": "CDCWPKI01.rootblue.lan", "severityValue": "AUDIT_SUCCESS", "message": "A security setting was updated on OCSP Responder Service.\n\nNew Value:\t\nAllow(0x00000101)\tBUILTIN\\Administrators\n\tOCSP Administrator\n\tRead\nAllow(0x00000300)\tIIS APPPOOL\\OCSPISAPIAppPool\n\tRead\n\tOCSP Requestor"}, "eventdata": {"newSecuritySettings": "Allow(0x00000101)\tBUILTIN\\Administrators\n\tOCSP Administrator\n\tRead\nAllow(0x00000300)\tIIS APPPOOL\\OCSPISAPIAppPool\n\tRead\n\tOCSP Requestor", "subjectUserSid": "S-1-5-21-392370121-190461309-2151315433-1108", "subjectUserName": "domadm", "subjectDomainName": "ROOTBLUE", "subjectLogonId": "0x91861a6"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "5123", "version": "0", "level": "0", "task": "12805", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2024-09-03T07:48:18.6282450Z", "eventRecordID": "375292", "processID": "640", "threadID": "5752", "channel": "Security", "computer": "CDCWPKI01.rootblue.lan", "severityValue": "AUDIT_SUCCESS", "message": "A configuration entry changed in the OCSP Responder Service.\n\nProperty Name:\t\tMaxNumOfCacheEntries\nNew Value:\t\t5002"}, "eventdata": {"propertyName": "MaxNumOfCacheEntries", "newValue": "5002", "subjectUserSid": "S-1-5-21-392370121-190461309-2151315433-1108", "subjectUserName": "domadm", "subjectDomainName": "ROOTBLUE", "subjectLogonId": "0x91861a6"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "5123", "version": "0", "level": "0", "task": "12805", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2024-09-03T07:48:18.6284396Z", "eventRecordID": "375293", "processID": "640", "threadID": "5752", "channel": "Security", "computer": "CDCWPKI01.rootblue.lan", "severityValue": "AUDIT_SUCCESS", "message": "A configuration entry changed in the OCSP Responder Service.\n\nProperty Name:\t\tNumOfThreads\nNew Value:\t\t512"}, "eventdata": {"propertyName": "NumOfThreads", "newValue": "512", "subjectUserSid": "S-1-5-21-392370121-190461309-2151315433-1108", "subjectUserName": "domadm", "subjectDomainName": "ROOTBLUE", "subjectLogonId": "0x91861a6"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "5123", "version": "0", "level": "0", "task": "12805", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2024-09-03T07:48:54.4435532Z", "eventRecordID": "375299", "processID": "640", "threadID": "5752", "channel": "Security", "computer": "CDCWPKI01.rootblue.lan", "severityValue": "AUDIT_SUCCESS", "message": "A configuration entry changed in the OCSP Responder Service.\n\nProperty Name:\t\tAuditFilter\nNew Value:\t\t7"}, "eventdata": {"propertyName": "AuditFilter", "newValue": "7", "subjectUserSid": "S-1-5-21-392370121-190461309-2151315433-1108", "subjectUserName": "domadm", "subjectDomainName": "ROOTBLUE", "subjectLogonId": "0x91861a6"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "5123", "version": "0", "level": "0", "task": "12805", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2024-09-03T07:49:06.9893061Z", "eventRecordID": "375300", "processID": "640", "threadID": "5752", "channel": "Security", "computer": "CDCWPKI01.rootblue.lan", "severityValue": "AUDIT_SUCCESS", "message": "A configuration entry changed in the OCSP Responder Service.\n\nProperty Name:\t\tAuditFilter\nNew Value:\t\t0"}, "eventdata": {"propertyName": "AuditFilter", "newValue": "0", "subjectUserSid": "S-1-5-21-392370121-190461309-2151315433-1108", "subjectUserName": "domadm", "subjectDomainName": "ROOTBLUE", "subjectLogonId": "0x91861a6"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "5124", "version": "0", "level": "0", "task": "12805", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2024-09-03T07:51:23.5163056Z", "eventRecordID": "375313", "processID": "640", "threadID": "6232", "channel": "Security", "computer": "CDCWPKI01.rootblue.lan", "severityValue": "AUDIT_SUCCESS", "message": "A security setting was updated on OCSP Responder Service.\n\nNew Value:\t\nAllow(0x00000101)\tBUILTIN\\Administrators\n\tOCSP Administrator\n\tRead\nAllow(0x00000101)\tROOTBLUE\\Hacker_Group\n\tOCSP Administrator\n\tRead\nAllow(0x00000300)\tIIS APPPOOL\\OCSPISAPIAppPool\n\tRead\n\tOCSP Requestor"}, "eventdata": {"newSecuritySettings": "Allow(0x00000101)\tBUILTIN\\Administrators\n\tOCSP Administrator\n\tRead\nAllow(0x00000101)\tROOTBLUE\\Hacker_Group\n\tOCSP Administrator\n\tRead\nAllow(0x00000300)\tIIS APPPOOL\\OCSPISAPIAppPool\n\tRead\n\tOCSP Requestor", "subjectUserSid": "S-1-5-21-392370121-190461309-2151315433-1108", "subjectUserName": "domadm", "subjectDomainName": "ROOTBLUE", "subjectLogonId": "0x91861a6"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "5124", "version": "0", "level": "0", "task": "12805", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2024-09-03T08:01:32.9529718Z", "eventRecordID": "375387", "processID": "640", "threadID": "7036", "channel": "Security", "computer": "CDCWPKI01.rootblue.lan", "severityValue": "AUDIT_SUCCESS", "message": "A security setting was updated on OCSP Responder Service.\n\nNew Value:\t\nAllow(0x00000101)\tBUILTIN\\Administrators\n\tOCSP Administrator\n\tRead\nAllow(0x00000300)\tIIS APPPOOL\\OCSPISAPIAppPool\n\tRead\n\tOCSP Requestor"}, "eventdata": {"newSecuritySettings": "Allow(0x00000101)\tBUILTIN\\Administrators\n\tOCSP Administrator\n\tRead\nAllow(0x00000300)\tIIS APPPOOL\\OCSPISAPIAppPool\n\tRead\n\tOCSP Requestor", "subjectUserSid": "S-1-5-21-392370121-190461309-2151315433-1108", "subjectUserName": "domadm", "subjectDomainName": "ROOTBLUE", "subjectLogonId": "0x91861a6"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "5124", "version": "0", "level": "0", "task": "12805", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2024-09-03T08:02:28.9965012Z", "eventRecordID": "375393", "processID": "640", "threadID": "7036", "channel": "Security", "computer": "CDCWPKI01.rootblue.lan", "severityValue": "AUDIT_SUCCESS", "message": "A security setting was updated on OCSP Responder Service.\n\nNew Value:\t\nAllow(0x00000101)\tBUILTIN\\Administrators\n\tOCSP Administrator\n\tRead\nAllow(0x00000101)\tROOTBLUE\\Hacker_Group\n\tOCSP Administrator\n\tRead\nAllow(0x00000300)\tIIS APPPOOL\\OCSPISAPIAppPool\n\tRead\n\tOCSP Requestor"}, "eventdata": {"newSecuritySettings": "Allow(0x00000101)\tBUILTIN\\Administrators\n\tOCSP Administrator\n\tRead\nAllow(0x00000101)\tROOTBLUE\\Hacker_Group\n\tOCSP Administrator\n\tRead\nAllow(0x00000300)\tIIS APPPOOL\\OCSPISAPIAppPool\n\tRead\n\tOCSP Requestor", "subjectUserSid": "S-1-5-21-392370121-190461309-2151315433-1108", "subjectUserName": "domadm", "subjectDomainName": "ROOTBLUE", "subjectLogonId": "0x91861a6"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "5124", "version": "0", "level": "0", "task": "12805", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2024-09-03T08:04:23.1889389Z", "eventRecordID": "375405", "processID": "640", "threadID": "5752", "channel": "Security", "computer": "CDCWPKI01.rootblue.lan", "severityValue": "AUDIT_SUCCESS", "message": "A security setting was updated on OCSP Responder Service.\n\nNew Value:\t\nAllow(0x00000301)\tROOTBLUE\\Hacker_Group\n\tOCSP Administrator\n\tRead\n\tOCSP Requestor\nAllow(0x00000101)\tBUILTIN\\Administrators\n\tOCSP Administrator\n\tRead\nAllow(0x00000300)\tIIS APPPOOL\\OCSPISAPIAppPool\n\tRead\n\tOCSP Requestor"}, "eventdata": {"newSecuritySettings": "Allow(0x00000301)\tROOTBLUE\\Hacker_Group\n\tOCSP Administrator\n\tRead\n\tOCSP Requestor\nAllow(0x00000101)\tBUILTIN\\Administrators\n\tOCSP Administrator\n\tRead\nAllow(0x00000300)\tIIS APPPOOL\\OCSPISAPIAppPool\n\tRead\n\tOCSP Requestor", "subjectUserSid": "S-1-5-21-392370121-190461309-2151315433-1108", "subjectUserName": "domadm", "subjectDomainName": "ROOTBLUE", "subjectLogonId": "0x91861a6"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4876", "version": "0", "level": "0", "task": "12805", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2024-09-03T10:41:30.9595345Z", "eventRecordID": "376329", "processID": "640", "threadID": "4156", "channel": "Security", "computer": "CDCWPKI01.rootblue.lan", "severityValue": "AUDIT_SUCCESS", "message": "Certificate Services backup started.\n\nBackup Type:\t1"}, "eventdata": {"backupType": "1", "subjectUserSid": "S-1-5-21-392370121-190461309-2151315433-1108", "subjectUserName": "domadm", "subjectDomainName": "ROOTBLUE", "subjectLogonId": "0x91861a6"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4877", "version": "0", "level": "0", "task": "12805", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2024-09-03T10:41:31.1455407Z", "eventRecordID": "376330", "processID": "640", "threadID": "4156", "channel": "Security", "computer": "CDCWPKI01.rootblue.lan", "severityValue": "AUDIT_SUCCESS", "message": "Certificate Services backup completed."}, "eventdata": {"subjectUserSid": "S-1-5-21-392370121-190461309-2151315433-1108", "subjectUserName": "domadm", "subjectDomainName": "ROOTBLUE", "subjectLogonId": "0x91861a6"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4885", "version": "0", "level": "0", "task": "12805", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2024-09-03T10:42:09.3735626Z", "eventRecordID": "376331", "processID": "640", "threadID": "4156", "channel": "Security", "computer": "CDCWPKI01.rootblue.lan", "severityValue": "AUDIT_SUCCESS", "message": "The audit filter for Certificate Services changed.\n\t\nFilter:\t111"}, "eventdata": {"auditFilter": "111", "subjectUserSid": "S-1-5-21-392370121-190461309-2151315433-1108", "subjectUserName": "domadm", "subjectDomainName": "ROOTBLUE", "subjectLogonId": "0x91861a6"}}}'''
        ]

        responses = send_multiple_logs(logs, location="stdin", log_format="json")

        # Ensure we receive a response for each log sent
        self.assertEqual(len(responses), len(logs))

        for _, response in enumerate(responses):
            self.assertEqual(response.status, LogtestStatus.RuleMatch)
            self.assertEqual(response.decoder, 'json')

            # Example: Set expected Wazuh rule ID and level when analyzing logs
            # expected_rule_id = None  # Replace with actual rule ID
            # expected_rule_level = None  # Replace with actual rule level

            # self.assertEqual(response.rule_id, expected_rule_id)
            # self.assertEqual(response.rule_level, expected_rule_level)

        # TODO: Write the expected result as test cases when the logs are analyzed by Wazuh.
        self.fail("Test not implemented yet. Define expected results.")

    def test_id4908_special_group_table_changed(self) -> None:
        # Logs extracted from EVTX file
        logs = [
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4908", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2020-07-12T06:01:51.7980272Z", "eventRecordID": "16088364", "processID": "528", "threadID": "548", "channel": "Security", "computer": "rootdc1.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Special Groups Logon table modified.\n\nSpecial Groups:\t-\n\nThis event is generated when the list of special groups is updated in the registry or through security policy. The updated list of special groups is indicated in the event."}, "eventdata": {}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4908", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2020-07-12T06:01:51.8077032Z", "eventRecordID": "16088366", "processID": "528", "threadID": "548", "channel": "Security", "computer": "rootdc1.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Special Groups Logon table modified.\n\nSpecial Groups:\t\n\t\t%{S-1-5-21-4230534742-2542757381-3142984815-1613}\n\t\t%{S-1-5-21-4230534742-2542757381-3142984815-1614}\n\nThis event is generated when the list of special groups is updated in the registry or through security policy. The updated list of special groups is indicated in the event."}, "eventdata": {}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4908", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2020-07-12T06:06:52.4486853Z", "eventRecordID": "16090216", "processID": "528", "threadID": "548", "channel": "Security", "computer": "rootdc1.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Special Groups Logon table modified.\n\nSpecial Groups:\t-\n\nThis event is generated when the list of special groups is updated in the registry or through security policy. The updated list of special groups is indicated in the event."}, "eventdata": {}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4908", "version": "0", "level": "0", "task": "13568", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2020-07-12T06:06:52.4583164Z", "eventRecordID": "16090218", "processID": "528", "threadID": "548", "channel": "Security", "computer": "rootdc1.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "Special Groups Logon table modified.\n\nSpecial Groups:\t\n\t\t%{S-1-5-21-4230534742-2542757381-3142984815-1613}\n\t\t%{S-1-5-21-4230534742-2542757381-3142984815-1614}\n\t\t%{S-1-5-21-4230534742-2542757381-3142984815-1615}\n\nThis event is generated when the list of special groups is updated in the registry or through security policy. The updated list of special groups is indicated in the event."}, "eventdata": {}}}'''
        ]

        responses = send_multiple_logs(logs, location="stdin", log_format="json")

        # Ensure we receive a response for each log sent
        self.assertEqual(len(responses), len(logs))

        for _, response in enumerate(responses):
            self.assertEqual(response.status, LogtestStatus.RuleMatch)
            self.assertEqual(response.decoder, 'json')

            # Example: Set expected Wazuh rule ID and level when analyzing logs
            # expected_rule_id = None  # Replace with actual rule ID
            # expected_rule_level = None  # Replace with actual rule level

            # self.assertEqual(response.rule_id, expected_rule_id)
            # self.assertEqual(response.rule_level, expected_rule_level)

        # TODO: Write the expected result as test cases when the logs are analyzed by Wazuh.
        self.fail("Test not implemented yet. Define expected results.")

    def test_id541_dns_server_auditing_changed(self) -> None:
        # Logs extracted from EVTX file
        logs = [
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-DNSServer", "providerGuid": "{eb79061a-a566-4698-9119-3ed2807060e7}", "eventID": "541", "version": "0", "level": "4", "task": "10", "opcode": "0", "keywords": "0x4000000008000000", "systemTime": "2025-01-08T22:23:37.9908518Z", "eventRecordID": "3220", "processID": "6244", "threadID": "2748", "channel": "Microsoft-Windows-DNSServer/Audit", "computer": "CDCWRDC01.rootblue.lan", "severityValue": "INFORMATION", "message": "Failed to get metadata for provider Microsoft-Windows-DNSServer)"}, "eventdata": {"setting": "EventLogLevel", "scope": ".", "newValue": "7"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-DNSServer", "providerGuid": "{eb79061a-a566-4698-9119-3ed2807060e7}", "eventID": "541", "version": "0", "level": "4", "task": "10", "opcode": "0", "keywords": "0x4000000008000000", "systemTime": "2025-01-08T22:23:52.1458387Z", "eventRecordID": "3221", "processID": "6244", "threadID": "2748", "channel": "Microsoft-Windows-DNSServer/Audit", "computer": "CDCWRDC01.rootblue.lan", "severityValue": "INFORMATION", "message": "Failed to get metadata for provider Microsoft-Windows-DNSServer)"}, "eventdata": {"setting": "EnableDnsSec", "scope": ".", "newValue": "0"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-DNSServer", "providerGuid": "{eb79061a-a566-4698-9119-3ed2807060e7}", "eventID": "541", "version": "0", "level": "4", "task": "10", "opcode": "0", "keywords": "0x4000000008000000", "systemTime": "2025-01-08T22:23:52.1463521Z", "eventRecordID": "3222", "processID": "6244", "threadID": "2748", "channel": "Microsoft-Windows-DNSServer/Audit", "computer": "CDCWRDC01.rootblue.lan", "severityValue": "INFORMATION", "message": "Failed to get metadata for provider Microsoft-Windows-DNSServer)"}, "eventdata": {"setting": "EventLogLevel", "scope": ".", "newValue": "2"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-DNSServer", "providerGuid": "{eb79061a-a566-4698-9119-3ed2807060e7}", "eventID": "541", "version": "0", "level": "4", "task": "10", "opcode": "0", "keywords": "0x4000000008000000", "systemTime": "2025-01-08T22:23:53.8348288Z", "eventRecordID": "3223", "processID": "6244", "threadID": "2748", "channel": "Microsoft-Windows-DNSServer/Audit", "computer": "CDCWRDC01.rootblue.lan", "severityValue": "INFORMATION", "message": "Failed to get metadata for provider Microsoft-Windows-DNSServer)"}, "eventdata": {"setting": "EventLogLevel", "scope": ".", "newValue": "1"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-DNSServer", "providerGuid": "{eb79061a-a566-4698-9119-3ed2807060e7}", "eventID": "541", "version": "0", "level": "4", "task": "10", "opcode": "0", "keywords": "0x4000000008000000", "systemTime": "2025-01-08T22:23:55.5671583Z", "eventRecordID": "3224", "processID": "6244", "threadID": "2748", "channel": "Microsoft-Windows-DNSServer/Audit", "computer": "CDCWRDC01.rootblue.lan", "severityValue": "INFORMATION", "message": "Failed to get metadata for provider Microsoft-Windows-DNSServer)"}, "eventdata": {"setting": "EventLogLevel", "scope": ".", "newValue": "0"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-DNSServer", "providerGuid": "{eb79061a-a566-4698-9119-3ed2807060e7}", "eventID": "541", "version": "0", "level": "4", "task": "10", "opcode": "0", "keywords": "0x4000000008000000", "systemTime": "2025-01-08T22:23:57.5280098Z", "eventRecordID": "3225", "processID": "6244", "threadID": "2748", "channel": "Microsoft-Windows-DNSServer/Audit", "computer": "CDCWRDC01.rootblue.lan", "severityValue": "INFORMATION", "message": "Failed to get metadata for provider Microsoft-Windows-DNSServer)"}, "eventdata": {"setting": "EventLogLevel", "scope": ".", "newValue": "7"}}}'''
        ]

        responses = send_multiple_logs(logs, location="stdin", log_format="json")

        # Ensure we receive a response for each log sent
        self.assertEqual(len(responses), len(logs))

        for _, response in enumerate(responses):
            self.assertEqual(response.status, LogtestStatus.RuleMatch)
            self.assertEqual(response.decoder, 'json')

            # Example: Set expected Wazuh rule ID and level when analyzing logs
            # expected_rule_id = None  # Replace with actual rule ID
            # expected_rule_level = None  # Replace with actual rule level

            # self.assertEqual(response.rule_id, expected_rule_id)
            # self.assertEqual(response.rule_level, expected_rule_level)

        # TODO: Write the expected result as test cases when the logs are analyzed by Wazuh.
        self.fail("Test not implemented yet. Define expected results.")

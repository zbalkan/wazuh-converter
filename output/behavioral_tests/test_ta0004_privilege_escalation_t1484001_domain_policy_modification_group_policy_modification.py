import unittest

from internal.logtest import LogtestStatus, send_multiple_logs  # type: ignore


class TestTa0004PrivilegeEscalationT1484001DomainPolicyModificationGroupPolicyModification(unittest.TestCase):

    def test_id5136_4662_sensitive_gpo_edited(self) -> None:
        # Logs extracted from EVTX file
        logs = [
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4662", "version": "0", "level": "0", "task": "14080", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-02-22T22:47:38.9988523Z", "eventRecordID": "111660452", "processID": "556", "threadID": "12772", "channel": "Security", "computer": "rootdc1.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "An operation was performed on an object.\n\nSubject :\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x24E2CBF6\n\nObject:\n\tObject Server:\t\tDS\n\tObject Type:\t\t%{f30e3bc2-9ff0-11d1-b603-0000f80367c1}\n\tObject Name:\t\t%{244db979-f8ae-4695-9e37-2104a17a967f}\n\tHandle ID:\t\t0x0\n\nOperation:\n\tOperation Type:\t\tObject Access\n\tAccesses:\t\tWrite Property\n\t\t\t\t\n\tAccess Mask:\t\t0x20\n\tProperties:\t\tWrite Property\n\t\t{771727b1-31b8-4cdf-ae62-4fe39fadf89e}\n\t\t\t{bf967a76-0de6-11d0-a285-00aa003049e2}\n\t{f30e3bc2-9ff0-11d1-b603-0000f80367c1}\n\n\nAdditional Information:\n\tParameter 1:\t\t-\n\tParameter 2:"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x24e2cbf6", "objectServer": "DS", "objectType": "%{f30e3bc2-9ff0-11d1-b603-0000f80367c1}", "objectName": "%{244db979-f8ae-4695-9e37-2104a17a967f}", "operationType": "Object Access", "handleId": "0x0", "accessList": "%%7685", "accessMask": "0x20", "properties": "%%7685\n\t\t{771727b1-31b8-4cdf-ae62-4fe39fadf89e}\n\t\t\t{bf967a76-0de6-11d0-a285-00aa003049e2}\n\t{f30e3bc2-9ff0-11d1-b603-0000f80367c1}"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "5136", "version": "0", "level": "0", "task": "14081", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-02-22T22:47:43.6450515Z", "eventRecordID": "111660461", "processID": "556", "threadID": "4060", "channel": "Security", "computer": "rootdc1.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "A directory service object was modified.\n\t\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x24E2CBF6\n\nDirectory Service:\n\tName:\toffsec.lan\n\tType:\tActive Directory Domain Services\n\t\nObject:\n\tDN:\tCN={127328D6-A8A8-49E3-BA71-410C945F42CE},CN=POLICIES,CN=SYSTEM,DC=OFFSEC,DC=LAN\n\tGUID:\t{244db979-f8ae-4695-9e37-2104a17a967f}\n\tClass:\tgroupPolicyContainer\n\t\nAttribute:\n\tLDAP Display Name:\tversionNumber\n\tSyntax (OID):\t2.5.5.9\n\tValue:\t1\n\t\nOperation:\n\tType:\tValue Deleted\n\tCorrelation ID:\t{90949b97-6477-4d47-ab9d-e291f4fe8e34}\n\tApplication Correlation ID:\t-"}, "eventdata": {"opCorrelationID": "{90949b97-6477-4d47-ab9d-e291f4fe8e34}", "subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x24e2cbf6", "dSName": "offsec.lan", "dSType": "%%14676", "objectDN": "CN={127328D6-A8A8-49E3-BA71-410C945F42CE},CN=POLICIES,CN=SYSTEM,DC=OFFSEC,DC=LAN", "objectGUID": "{244db979-f8ae-4695-9e37-2104a17a967f}", "objectClass": "groupPolicyContainer", "attributeLDAPDisplayName": "versionNumber", "attributeSyntaxOID": "2.5.5.9", "attributeValue": "1", "operationType": "%%14675"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "5136", "version": "0", "level": "0", "task": "14081", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-02-22T22:47:43.6452710Z", "eventRecordID": "111660462", "processID": "556", "threadID": "15032", "channel": "Security", "computer": "rootdc1.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "A directory service object was modified.\n\t\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x24E2CBF6\n\nDirectory Service:\n\tName:\toffsec.lan\n\tType:\tActive Directory Domain Services\n\t\nObject:\n\tDN:\tCN={127328D6-A8A8-49E3-BA71-410C945F42CE},CN=POLICIES,CN=SYSTEM,DC=OFFSEC,DC=LAN\n\tGUID:\t{244db979-f8ae-4695-9e37-2104a17a967f}\n\tClass:\tgroupPolicyContainer\n\t\nAttribute:\n\tLDAP Display Name:\tversionNumber\n\tSyntax (OID):\t2.5.5.9\n\tValue:\t2\n\t\nOperation:\n\tType:\tValue Added\n\tCorrelation ID:\t{90949b97-6477-4d47-ab9d-e291f4fe8e34}\n\tApplication Correlation ID:\t-"}, "eventdata": {"opCorrelationID": "{90949b97-6477-4d47-ab9d-e291f4fe8e34}", "subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x24e2cbf6", "dSName": "offsec.lan", "dSType": "%%14676", "objectDN": "CN={127328D6-A8A8-49E3-BA71-410C945F42CE},CN=POLICIES,CN=SYSTEM,DC=OFFSEC,DC=LAN", "objectGUID": "{244db979-f8ae-4695-9e37-2104a17a967f}", "objectClass": "groupPolicyContainer", "attributeLDAPDisplayName": "versionNumber", "attributeSyntaxOID": "2.5.5.9", "attributeValue": "2", "operationType": "%%14674"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4662", "version": "0", "level": "0", "task": "14080", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-02-22T22:50:32.6535844Z", "eventRecordID": "111660719", "processID": "556", "threadID": "4060", "channel": "Security", "computer": "rootdc1.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "An operation was performed on an object.\n\nSubject :\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1105\n\tAccount Name:\t\tFS02$\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x24E33DF2\n\nObject:\n\tObject Server:\t\tDS\n\tObject Type:\t\t%{bf967a86-0de6-11d0-a285-00aa003049e2}\n\tObject Name:\t\t%{aaf7533a-9112-4d0f-8cb4-a2c40aed4741}\n\tHandle ID:\t\t0x0\n\nOperation:\n\tOperation Type:\t\tObject Access\n\tAccesses:\t\t-\n\tAccess Mask:\t\t0x0\n\tProperties:\t\t---\n\t{bf967a86-0de6-11d0-a285-00aa003049e2}\nControl Access\n\t\t\t{6617e4ac-a2f1-43ab-b60c-11fbd1facf05}\n\t\t\t{b3f93023-9239-4f7c-b99c-6745d87adbc2}\n\t\t\t{b8dfa744-31dc-4ef1-ac7c-84baf7ef9da7}\n\t\t\t{b7ff5a38-0818-42b0-8110-d3d154c97f24}\n\t\t{91e647de-d96f-4b70-9557-d63ff4f3ccd8}\n\n\nAdditional Information:\n\tParameter 1:\t\t-\n\tParameter 2:"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1105", "subjectUserName": "FS02$", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x24e33df2", "objectServer": "DS", "objectType": "%{bf967a86-0de6-11d0-a285-00aa003049e2}", "objectName": "%{aaf7533a-9112-4d0f-8cb4-a2c40aed4741}", "operationType": "Object Access", "handleId": "0x0", "accessMask": "0x0", "properties": "---\n\t{bf967a86-0de6-11d0-a285-00aa003049e2}\n%%7688\n\t\t\t{6617e4ac-a2f1-43ab-b60c-11fbd1facf05}\n\t\t\t{b3f93023-9239-4f7c-b99c-6745d87adbc2}\n\t\t\t{b8dfa744-31dc-4ef1-ac7c-84baf7ef9da7}\n\t\t\t{b7ff5a38-0818-42b0-8110-d3d154c97f24}\n\t\t{91e647de-d96f-4b70-9557-d63ff4f3ccd8}"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4662", "version": "0", "level": "0", "task": "14080", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-02-22T22:50:32.6673245Z", "eventRecordID": "111660722", "processID": "556", "threadID": "12772", "channel": "Security", "computer": "rootdc1.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "An operation was performed on an object.\n\nSubject :\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1105\n\tAccount Name:\t\tFS02$\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x24E33E0B\n\nObject:\n\tObject Server:\t\tDS\n\tObject Type:\t\t%{bf967a86-0de6-11d0-a285-00aa003049e2}\n\tObject Name:\t\t%{aaf7533a-9112-4d0f-8cb4-a2c40aed4741}\n\tHandle ID:\t\t0x0\n\nOperation:\n\tOperation Type:\t\tObject Access\n\tAccesses:\t\t-\n\tAccess Mask:\t\t0x0\n\tProperties:\t\t---\n\t{bf967a86-0de6-11d0-a285-00aa003049e2}\nControl Access\n\t\t\t{6617e4ac-a2f1-43ab-b60c-11fbd1facf05}\n\t\t\t{b3f93023-9239-4f7c-b99c-6745d87adbc2}\n\t\t\t{b8dfa744-31dc-4ef1-ac7c-84baf7ef9da7}\n\t\t\t{b7ff5a38-0818-42b0-8110-d3d154c97f24}\n\t\t{91e647de-d96f-4b70-9557-d63ff4f3ccd8}\n\n\nAdditional Information:\n\tParameter 1:\t\t-\n\tParameter 2:"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1105", "subjectUserName": "FS02$", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x24e33e0b", "objectServer": "DS", "objectType": "%{bf967a86-0de6-11d0-a285-00aa003049e2}", "objectName": "%{aaf7533a-9112-4d0f-8cb4-a2c40aed4741}", "operationType": "Object Access", "handleId": "0x0", "accessMask": "0x0", "properties": "---\n\t{bf967a86-0de6-11d0-a285-00aa003049e2}\n%%7688\n\t\t\t{6617e4ac-a2f1-43ab-b60c-11fbd1facf05}\n\t\t\t{b3f93023-9239-4f7c-b99c-6745d87adbc2}\n\t\t\t{b8dfa744-31dc-4ef1-ac7c-84baf7ef9da7}\n\t\t\t{b7ff5a38-0818-42b0-8110-d3d154c97f24}\n\t\t{91e647de-d96f-4b70-9557-d63ff4f3ccd8}"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4662", "version": "0", "level": "0", "task": "14080", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-02-22T22:50:32.7926547Z", "eventRecordID": "111660727", "processID": "556", "threadID": "4060", "channel": "Security", "computer": "rootdc1.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "An operation was performed on an object.\n\nSubject :\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1105\n\tAccount Name:\t\tFS02$\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x24E33E2A\n\nObject:\n\tObject Server:\t\tDS\n\tObject Type:\t\t%{bf967a86-0de6-11d0-a285-00aa003049e2}\n\tObject Name:\t\t%{aaf7533a-9112-4d0f-8cb4-a2c40aed4741}\n\tHandle ID:\t\t0x0\n\nOperation:\n\tOperation Type:\t\tObject Access\n\tAccesses:\t\t-\n\tAccess Mask:\t\t0x0\n\tProperties:\t\t---\n\t{bf967a86-0de6-11d0-a285-00aa003049e2}\nControl Access\n\t\t\t{6617e4ac-a2f1-43ab-b60c-11fbd1facf05}\n\t\t\t{b3f93023-9239-4f7c-b99c-6745d87adbc2}\n\t\t\t{b8dfa744-31dc-4ef1-ac7c-84baf7ef9da7}\n\t\t\t{b7ff5a38-0818-42b0-8110-d3d154c97f24}\n\t\t{91e647de-d96f-4b70-9557-d63ff4f3ccd8}\n\n\nAdditional Information:\n\tParameter 1:\t\t-\n\tParameter 2:"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1105", "subjectUserName": "FS02$", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x24e33e2a", "objectServer": "DS", "objectType": "%{bf967a86-0de6-11d0-a285-00aa003049e2}", "objectName": "%{aaf7533a-9112-4d0f-8cb4-a2c40aed4741}", "operationType": "Object Access", "handleId": "0x0", "accessMask": "0x0", "properties": "---\n\t{bf967a86-0de6-11d0-a285-00aa003049e2}\n%%7688\n\t\t\t{6617e4ac-a2f1-43ab-b60c-11fbd1facf05}\n\t\t\t{b3f93023-9239-4f7c-b99c-6745d87adbc2}\n\t\t\t{b8dfa744-31dc-4ef1-ac7c-84baf7ef9da7}\n\t\t\t{b7ff5a38-0818-42b0-8110-d3d154c97f24}\n\t\t{91e647de-d96f-4b70-9557-d63ff4f3ccd8}"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4662", "version": "0", "level": "0", "task": "14080", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-02-22T22:50:32.8026452Z", "eventRecordID": "111660730", "processID": "556", "threadID": "12772", "channel": "Security", "computer": "rootdc1.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "An operation was performed on an object.\n\nSubject :\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1105\n\tAccount Name:\t\tFS02$\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x24E33E43\n\nObject:\n\tObject Server:\t\tDS\n\tObject Type:\t\t%{bf967a86-0de6-11d0-a285-00aa003049e2}\n\tObject Name:\t\t%{aaf7533a-9112-4d0f-8cb4-a2c40aed4741}\n\tHandle ID:\t\t0x0\n\nOperation:\n\tOperation Type:\t\tObject Access\n\tAccesses:\t\t-\n\tAccess Mask:\t\t0x0\n\tProperties:\t\t---\n\t{bf967a86-0de6-11d0-a285-00aa003049e2}\nControl Access\n\t\t\t{6617e4ac-a2f1-43ab-b60c-11fbd1facf05}\n\t\t\t{b3f93023-9239-4f7c-b99c-6745d87adbc2}\n\t\t\t{b8dfa744-31dc-4ef1-ac7c-84baf7ef9da7}\n\t\t\t{b7ff5a38-0818-42b0-8110-d3d154c97f24}\n\t\t{91e647de-d96f-4b70-9557-d63ff4f3ccd8}\n\n\nAdditional Information:\n\tParameter 1:\t\t-\n\tParameter 2:"}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1105", "subjectUserName": "FS02$", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x24e33e43", "objectServer": "DS", "objectType": "%{bf967a86-0de6-11d0-a285-00aa003049e2}", "objectName": "%{aaf7533a-9112-4d0f-8cb4-a2c40aed4741}", "operationType": "Object Access", "handleId": "0x0", "accessMask": "0x0", "properties": "---\n\t{bf967a86-0de6-11d0-a285-00aa003049e2}\n%%7688\n\t\t\t{6617e4ac-a2f1-43ab-b60c-11fbd1facf05}\n\t\t\t{b3f93023-9239-4f7c-b99c-6745d87adbc2}\n\t\t\t{b8dfa744-31dc-4ef1-ac7c-84baf7ef9da7}\n\t\t\t{b7ff5a38-0818-42b0-8110-d3d154c97f24}\n\t\t{91e647de-d96f-4b70-9557-d63ff4f3ccd8}"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4662", "version": "0", "level": "0", "task": "14080", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-02-22T22:50:43.6866128Z", "eventRecordID": "111660775", "processID": "556", "threadID": "12772", "channel": "Security", "computer": "rootdc1.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "An operation was performed on an object.\n\nSubject :\n\tSecurity ID:\t\tS-1-5-18\n\tAccount Name:\t\tROOTDC1$\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x24E3497D\n\nObject:\n\tObject Server:\t\tDS\n\tObject Type:\t\t%{bf967a86-0de6-11d0-a285-00aa003049e2}\n\tObject Name:\t\t%{832b1c45-2f6e-4c82-be40-d461e377f560}\n\tHandle ID:\t\t0x0\n\nOperation:\n\tOperation Type:\t\tObject Access\n\tAccesses:\t\tControl Access\n\t\t\t\t\n\tAccess Mask:\t\t0x100\n\tProperties:\t\tControl Access\n\t{bf967a86-0de6-11d0-a285-00aa003049e2}\n\t\t{91e647de-d96f-4b70-9557-d63ff4f3ccd8}\n\t\t\t{6617e4ac-a2f1-43ab-b60c-11fbd1facf05}\n\t\t\t{b3f93023-9239-4f7c-b99c-6745d87adbc2}\n\t\t\t{b8dfa744-31dc-4ef1-ac7c-84baf7ef9da7}\n\t\t\t{b7ff5a38-0818-42b0-8110-d3d154c97f24}\n\t\t{771727b1-31b8-4cdf-ae62-4fe39fadf89e}\n\t\t\t{aa4e1a6d-550d-4e05-8c35-4afcb917a9fe}\n\t\t\t{612cb747-c0e8-4f92-9221-fdd5f15b550d}\n\n\nAdditional Information:\n\tParameter 1:\t\t-\n\tParameter 2:"}, "eventdata": {"subjectUserSid": "S-1-5-18", "subjectUserName": "ROOTDC1$", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x24e3497d", "objectServer": "DS", "objectType": "%{bf967a86-0de6-11d0-a285-00aa003049e2}", "objectName": "%{832b1c45-2f6e-4c82-be40-d461e377f560}", "operationType": "Object Access", "handleId": "0x0", "accessList": "%%7688", "accessMask": "0x100", "properties": "%%7688\n\t{bf967a86-0de6-11d0-a285-00aa003049e2}\n\t\t{91e647de-d96f-4b70-9557-d63ff4f3ccd8}\n\t\t\t{6617e4ac-a2f1-43ab-b60c-11fbd1facf05}\n\t\t\t{b3f93023-9239-4f7c-b99c-6745d87adbc2}\n\t\t\t{b8dfa744-31dc-4ef1-ac7c-84baf7ef9da7}\n\t\t\t{b7ff5a38-0818-42b0-8110-d3d154c97f24}\n\t\t{771727b1-31b8-4cdf-ae62-4fe39fadf89e}\n\t\t\t{aa4e1a6d-550d-4e05-8c35-4afcb917a9fe}\n\t\t\t{612cb747-c0e8-4f92-9221-fdd5f15b550d}"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4662", "version": "0", "level": "0", "task": "14080", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-02-22T22:50:43.6986785Z", "eventRecordID": "111660779", "processID": "556", "threadID": "4060", "channel": "Security", "computer": "rootdc1.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "An operation was performed on an object.\n\nSubject :\n\tSecurity ID:\t\tS-1-5-18\n\tAccount Name:\t\tROOTDC1$\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x24E34AF9\n\nObject:\n\tObject Server:\t\tDS\n\tObject Type:\t\t%{bf967a86-0de6-11d0-a285-00aa003049e2}\n\tObject Name:\t\t%{832b1c45-2f6e-4c82-be40-d461e377f560}\n\tHandle ID:\t\t0x0\n\nOperation:\n\tOperation Type:\t\tObject Access\n\tAccesses:\t\tControl Access\n\t\t\t\t\n\tAccess Mask:\t\t0x100\n\tProperties:\t\tControl Access\n\t{bf967a86-0de6-11d0-a285-00aa003049e2}\n\t\t{91e647de-d96f-4b70-9557-d63ff4f3ccd8}\n\t\t\t{6617e4ac-a2f1-43ab-b60c-11fbd1facf05}\n\t\t\t{b3f93023-9239-4f7c-b99c-6745d87adbc2}\n\t\t\t{b8dfa744-31dc-4ef1-ac7c-84baf7ef9da7}\n\t\t\t{b7ff5a38-0818-42b0-8110-d3d154c97f24}\n\t\t{771727b1-31b8-4cdf-ae62-4fe39fadf89e}\n\t\t\t{aa4e1a6d-550d-4e05-8c35-4afcb917a9fe}\n\t\t\t{612cb747-c0e8-4f92-9221-fdd5f15b550d}\n\n\nAdditional Information:\n\tParameter 1:\t\t-\n\tParameter 2:"}, "eventdata": {"subjectUserSid": "S-1-5-18", "subjectUserName": "ROOTDC1$", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x24e34af9", "objectServer": "DS", "objectType": "%{bf967a86-0de6-11d0-a285-00aa003049e2}", "objectName": "%{832b1c45-2f6e-4c82-be40-d461e377f560}", "operationType": "Object Access", "handleId": "0x0", "accessList": "%%7688", "accessMask": "0x100", "properties": "%%7688\n\t{bf967a86-0de6-11d0-a285-00aa003049e2}\n\t\t{91e647de-d96f-4b70-9557-d63ff4f3ccd8}\n\t\t\t{6617e4ac-a2f1-43ab-b60c-11fbd1facf05}\n\t\t\t{b3f93023-9239-4f7c-b99c-6745d87adbc2}\n\t\t\t{b8dfa744-31dc-4ef1-ac7c-84baf7ef9da7}\n\t\t\t{b7ff5a38-0818-42b0-8110-d3d154c97f24}\n\t\t{771727b1-31b8-4cdf-ae62-4fe39fadf89e}\n\t\t\t{aa4e1a6d-550d-4e05-8c35-4afcb917a9fe}\n\t\t\t{612cb747-c0e8-4f92-9221-fdd5f15b550d}"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4662", "version": "0", "level": "0", "task": "14080", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-02-22T22:50:44.2028998Z", "eventRecordID": "111660801", "processID": "556", "threadID": "14852", "channel": "Security", "computer": "rootdc1.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "An operation was performed on an object.\n\nSubject :\n\tSecurity ID:\t\tS-1-5-18\n\tAccount Name:\t\tROOTDC1$\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x24E35D12\n\nObject:\n\tObject Server:\t\tDS\n\tObject Type:\t\t%{bf967a86-0de6-11d0-a285-00aa003049e2}\n\tObject Name:\t\t%{832b1c45-2f6e-4c82-be40-d461e377f560}\n\tHandle ID:\t\t0x0\n\nOperation:\n\tOperation Type:\t\tObject Access\n\tAccesses:\t\tControl Access\n\t\t\t\t\n\tAccess Mask:\t\t0x100\n\tProperties:\t\tControl Access\n\t{bf967a86-0de6-11d0-a285-00aa003049e2}\n\t\t{91e647de-d96f-4b70-9557-d63ff4f3ccd8}\n\t\t\t{6617e4ac-a2f1-43ab-b60c-11fbd1facf05}\n\t\t\t{b3f93023-9239-4f7c-b99c-6745d87adbc2}\n\t\t\t{b8dfa744-31dc-4ef1-ac7c-84baf7ef9da7}\n\t\t\t{b7ff5a38-0818-42b0-8110-d3d154c97f24}\n\t\t{771727b1-31b8-4cdf-ae62-4fe39fadf89e}\n\t\t\t{aa4e1a6d-550d-4e05-8c35-4afcb917a9fe}\n\t\t\t{612cb747-c0e8-4f92-9221-fdd5f15b550d}\n\n\nAdditional Information:\n\tParameter 1:\t\t-\n\tParameter 2:"}, "eventdata": {"subjectUserSid": "S-1-5-18", "subjectUserName": "ROOTDC1$", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x24e35d12", "objectServer": "DS", "objectType": "%{bf967a86-0de6-11d0-a285-00aa003049e2}", "objectName": "%{832b1c45-2f6e-4c82-be40-d461e377f560}", "operationType": "Object Access", "handleId": "0x0", "accessList": "%%7688", "accessMask": "0x100", "properties": "%%7688\n\t{bf967a86-0de6-11d0-a285-00aa003049e2}\n\t\t{91e647de-d96f-4b70-9557-d63ff4f3ccd8}\n\t\t\t{6617e4ac-a2f1-43ab-b60c-11fbd1facf05}\n\t\t\t{b3f93023-9239-4f7c-b99c-6745d87adbc2}\n\t\t\t{b8dfa744-31dc-4ef1-ac7c-84baf7ef9da7}\n\t\t\t{b7ff5a38-0818-42b0-8110-d3d154c97f24}\n\t\t{771727b1-31b8-4cdf-ae62-4fe39fadf89e}\n\t\t\t{aa4e1a6d-550d-4e05-8c35-4afcb917a9fe}\n\t\t\t{612cb747-c0e8-4f92-9221-fdd5f15b550d}"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4662", "version": "0", "level": "0", "task": "14080", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-02-22T22:50:44.2146760Z", "eventRecordID": "111660805", "processID": "556", "threadID": "12772", "channel": "Security", "computer": "rootdc1.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "An operation was performed on an object.\n\nSubject :\n\tSecurity ID:\t\tS-1-5-18\n\tAccount Name:\t\tROOTDC1$\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x24E35E8E\n\nObject:\n\tObject Server:\t\tDS\n\tObject Type:\t\t%{bf967a86-0de6-11d0-a285-00aa003049e2}\n\tObject Name:\t\t%{832b1c45-2f6e-4c82-be40-d461e377f560}\n\tHandle ID:\t\t0x0\n\nOperation:\n\tOperation Type:\t\tObject Access\n\tAccesses:\t\tControl Access\n\t\t\t\t\n\tAccess Mask:\t\t0x100\n\tProperties:\t\tControl Access\n\t{bf967a86-0de6-11d0-a285-00aa003049e2}\n\t\t{91e647de-d96f-4b70-9557-d63ff4f3ccd8}\n\t\t\t{6617e4ac-a2f1-43ab-b60c-11fbd1facf05}\n\t\t\t{b3f93023-9239-4f7c-b99c-6745d87adbc2}\n\t\t\t{b8dfa744-31dc-4ef1-ac7c-84baf7ef9da7}\n\t\t\t{b7ff5a38-0818-42b0-8110-d3d154c97f24}\n\t\t{771727b1-31b8-4cdf-ae62-4fe39fadf89e}\n\t\t\t{aa4e1a6d-550d-4e05-8c35-4afcb917a9fe}\n\t\t\t{612cb747-c0e8-4f92-9221-fdd5f15b550d}\n\n\nAdditional Information:\n\tParameter 1:\t\t-\n\tParameter 2:"}, "eventdata": {"subjectUserSid": "S-1-5-18", "subjectUserName": "ROOTDC1$", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x24e35e8e", "objectServer": "DS", "objectType": "%{bf967a86-0de6-11d0-a285-00aa003049e2}", "objectName": "%{832b1c45-2f6e-4c82-be40-d461e377f560}", "operationType": "Object Access", "handleId": "0x0", "accessList": "%%7688", "accessMask": "0x100", "properties": "%%7688\n\t{bf967a86-0de6-11d0-a285-00aa003049e2}\n\t\t{91e647de-d96f-4b70-9557-d63ff4f3ccd8}\n\t\t\t{6617e4ac-a2f1-43ab-b60c-11fbd1facf05}\n\t\t\t{b3f93023-9239-4f7c-b99c-6745d87adbc2}\n\t\t\t{b8dfa744-31dc-4ef1-ac7c-84baf7ef9da7}\n\t\t\t{b7ff5a38-0818-42b0-8110-d3d154c97f24}\n\t\t{771727b1-31b8-4cdf-ae62-4fe39fadf89e}\n\t\t\t{aa4e1a6d-550d-4e05-8c35-4afcb917a9fe}\n\t\t\t{612cb747-c0e8-4f92-9221-fdd5f15b550d}"}}}'''
        ]

        responses = send_multiple_logs(logs, location="stdin", log_format="json")

        # Ensure we receive a response for each log sent
        self.assertEqual(len(responses), len(logs))

        for _, response in enumerate(responses):
            self.assertEqual(response.status, LogtestStatus.RuleMatch)
            self.assertEqual(response.decoder, 'json')

            # Example: Set expected Wazuh rule ID and level when analyzing logs
            # expected_rule_id = None  # Replace with actual rule ID
            # expected_rule_level = None  # Replace with actual rule level

            # self.assertEqual(response.rule_id, expected_rule_id)
            # self.assertEqual(response.rule_level, expected_rule_level)

        # TODO: Write the expected result as test cases when the logs are analyzed by Wazuh.
        self.fail("Test not implemented yet. Define expected results.")

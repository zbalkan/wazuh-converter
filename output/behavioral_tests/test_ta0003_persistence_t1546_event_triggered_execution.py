import unittest

from internal.logtest import LogtestStatus, send_multiple_logs  # type: ignore


class TestTa0003PersistenceT1546EventTriggeredExecution(unittest.TestCase):

    def test_id13_wmiimplant_registry_crash_control(self) -> None:
        # Logs extracted from EVTX file
        logs = [
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Sysmon", "providerGuid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}", "eventID": "13", "version": "2", "level": "4", "task": "13", "opcode": "0", "keywords": "0x8000000000000000", "systemTime": "2021-11-08T10:01:49.7307768Z", "eventRecordID": "44683", "processID": "1068", "threadID": "1628", "channel": "Microsoft-Windows-Sysmon/Operational", "computer": "fs03vuln.offsec.lan", "severityValue": "INFORMATION", "message": "Registry value set:\nRuleName: -\nEventType: SetValue\nUtcTime: 2021-11-08 10:01:49.730\nProcessGuid: {a57649d1-12fd-6179-028b-000000000000}\nProcessId: 472\nImage: C:\\Windows\\system32\\services.exe\nTargetObject: HKLM\\System\\CurrentControlSet\\Services\\hacker23\\Start\nDetails: DWORD (0x00000002)\nUser: %9"}, "eventdata": {"eventType": "SetValue", "utcTime": "2021-11-08 10:01:49.730", "processGuid": "{a57649d1-12fd-6179-028b-000000000000}", "processId": "472", "image": "C:\\Windows\\system32\\services.exe", "targetObject": "HKLM\\System\\CurrentControlSet\\Services\\hacker23\\Start", "details": "DWORD (0x00000002)"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Sysmon", "providerGuid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}", "eventID": "13", "version": "2", "level": "4", "task": "13", "opcode": "0", "keywords": "0x8000000000000000", "systemTime": "2021-11-08T10:01:49.7307768Z", "eventRecordID": "44684", "processID": "1068", "threadID": "1628", "channel": "Microsoft-Windows-Sysmon/Operational", "computer": "fs03vuln.offsec.lan", "severityValue": "INFORMATION", "message": "Registry value set:\nRuleName: -\nEventType: SetValue\nUtcTime: 2021-11-08 10:01:49.730\nProcessGuid: {a57649d1-12fd-6179-028b-000000000000}\nProcessId: 472\nImage: C:\\Windows\\system32\\services.exe\nTargetObject: HKLM\\System\\CurrentControlSet\\Services\\hacker23\\ImagePath\nDetails: c:\\\nUser: %9"}, "eventdata": {"eventType": "SetValue", "utcTime": "2021-11-08 10:01:49.730", "processGuid": "{a57649d1-12fd-6179-028b-000000000000}", "processId": "472", "image": "C:\\Windows\\system32\\services.exe", "targetObject": "HKLM\\System\\CurrentControlSet\\Services\\hacker23\\ImagePath", "details": "c:\\"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Sysmon", "providerGuid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}", "eventID": "13", "version": "2", "level": "4", "task": "13", "opcode": "0", "keywords": "0x8000000000000000", "systemTime": "2021-11-08T10:26:55.1237824Z", "eventRecordID": "44689", "processID": "1068", "threadID": "1628", "channel": "Microsoft-Windows-Sysmon/Operational", "computer": "fs03vuln.offsec.lan", "severityValue": "INFORMATION", "message": "Registry value set:\nRuleName: technique_id=T1047,technique_name=Windows Management Instrumentation\nEventType: SetValue\nUtcTime: 2021-11-08 10:26:55.123\nProcessGuid: {a57649d1-1303-6179-d9c8-010000000000}\nProcessId: 1508\nImage: C:\\Windows\\system32\\wbem\\wmiprvse.exe\nTargetObject: HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\LogEvent\nDetails: DWORD (0x00000001)\nUser: %9"}, "eventdata": {"ruleName": "technique_id=T1047,technique_name=Windows Management Instrumentation", "eventType": "SetValue", "utcTime": "2021-11-08 10:26:55.123", "processGuid": "{a57649d1-1303-6179-d9c8-010000000000}", "processId": "1508", "image": "C:\\Windows\\system32\\wbem\\wmiprvse.exe", "targetObject": "HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\LogEvent", "details": "DWORD (0x00000001)"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Sysmon", "providerGuid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}", "eventID": "13", "version": "2", "level": "4", "task": "13", "opcode": "0", "keywords": "0x8000000000000000", "systemTime": "2021-11-08T10:26:55.1237824Z", "eventRecordID": "44690", "processID": "1068", "threadID": "1628", "channel": "Microsoft-Windows-Sysmon/Operational", "computer": "fs03vuln.offsec.lan", "severityValue": "INFORMATION", "message": "Registry value set:\nRuleName: technique_id=T1047,technique_name=Windows Management Instrumentation\nEventType: SetValue\nUtcTime: 2021-11-08 10:26:55.123\nProcessGuid: {a57649d1-1303-6179-d9c8-010000000000}\nProcessId: 1508\nImage: C:\\Windows\\system32\\wbem\\wmiprvse.exe\nTargetObject: HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\SendAlert\nDetails: DWORD (0x00000000)\nUser: %9"}, "eventdata": {"ruleName": "technique_id=T1047,technique_name=Windows Management Instrumentation", "eventType": "SetValue", "utcTime": "2021-11-08 10:26:55.123", "processGuid": "{a57649d1-1303-6179-d9c8-010000000000}", "processId": "1508", "image": "C:\\Windows\\system32\\wbem\\wmiprvse.exe", "targetObject": "HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\SendAlert", "details": "DWORD (0x00000000)"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Sysmon", "providerGuid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}", "eventID": "13", "version": "2", "level": "4", "task": "13", "opcode": "0", "keywords": "0x8000000000000000", "systemTime": "2021-11-08T10:26:55.1237824Z", "eventRecordID": "44691", "processID": "1068", "threadID": "1628", "channel": "Microsoft-Windows-Sysmon/Operational", "computer": "fs03vuln.offsec.lan", "severityValue": "INFORMATION", "message": "Registry value set:\nRuleName: technique_id=T1047,technique_name=Windows Management Instrumentation\nEventType: SetValue\nUtcTime: 2021-11-08 10:26:55.123\nProcessGuid: {a57649d1-1303-6179-d9c8-010000000000}\nProcessId: 1508\nImage: C:\\Windows\\system32\\wbem\\wmiprvse.exe\nTargetObject: HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\CrashDumpEnabled\nDetails: DWORD (0x00000007)\nUser: %9"}, "eventdata": {"ruleName": "technique_id=T1047,technique_name=Windows Management Instrumentation", "eventType": "SetValue", "utcTime": "2021-11-08 10:26:55.123", "processGuid": "{a57649d1-1303-6179-d9c8-010000000000}", "processId": "1508", "image": "C:\\Windows\\system32\\wbem\\wmiprvse.exe", "targetObject": "HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\CrashDumpEnabled", "details": "DWORD (0x00000007)"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Sysmon", "providerGuid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}", "eventID": "13", "version": "2", "level": "4", "task": "13", "opcode": "0", "keywords": "0x8000000000000000", "systemTime": "2021-11-08T10:26:55.1237824Z", "eventRecordID": "44692", "processID": "1068", "threadID": "1628", "channel": "Microsoft-Windows-Sysmon/Operational", "computer": "fs03vuln.offsec.lan", "severityValue": "INFORMATION", "message": "Registry value set:\nRuleName: technique_id=T1047,technique_name=Windows Management Instrumentation\nEventType: SetValue\nUtcTime: 2021-11-08 10:26:55.123\nProcessGuid: {a57649d1-1303-6179-d9c8-010000000000}\nProcessId: 1508\nImage: C:\\Windows\\system32\\wbem\\wmiprvse.exe\nTargetObject: HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\Overwrite\nDetails: DWORD (0x00000001)\nUser: %9"}, "eventdata": {"ruleName": "technique_id=T1047,technique_name=Windows Management Instrumentation", "eventType": "SetValue", "utcTime": "2021-11-08 10:26:55.123", "processGuid": "{a57649d1-1303-6179-d9c8-010000000000}", "processId": "1508", "image": "C:\\Windows\\system32\\wbem\\wmiprvse.exe", "targetObject": "HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\Overwrite", "details": "DWORD (0x00000001)"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Sysmon", "providerGuid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}", "eventID": "13", "version": "2", "level": "4", "task": "13", "opcode": "0", "keywords": "0x8000000000000000", "systemTime": "2021-11-08T10:26:55.1237824Z", "eventRecordID": "44693", "processID": "1068", "threadID": "1628", "channel": "Microsoft-Windows-Sysmon/Operational", "computer": "fs03vuln.offsec.lan", "severityValue": "INFORMATION", "message": "Registry value set:\nRuleName: technique_id=T1047,technique_name=Windows Management Instrumentation\nEventType: SetValue\nUtcTime: 2021-11-08 10:26:55.123\nProcessGuid: {a57649d1-1303-6179-d9c8-010000000000}\nProcessId: 1508\nImage: C:\\Windows\\system32\\wbem\\wmiprvse.exe\nTargetObject: HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\KernelDumpOnly\nDetails: DWORD (0x00000000)\nUser: %9"}, "eventdata": {"ruleName": "technique_id=T1047,technique_name=Windows Management Instrumentation", "eventType": "SetValue", "utcTime": "2021-11-08 10:26:55.123", "processGuid": "{a57649d1-1303-6179-d9c8-010000000000}", "processId": "1508", "image": "C:\\Windows\\system32\\wbem\\wmiprvse.exe", "targetObject": "HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\KernelDumpOnly", "details": "DWORD (0x00000000)"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Sysmon", "providerGuid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}", "eventID": "13", "version": "2", "level": "4", "task": "13", "opcode": "0", "keywords": "0x8000000000000000", "systemTime": "2021-11-08T10:26:55.1394153Z", "eventRecordID": "44694", "processID": "1068", "threadID": "1628", "channel": "Microsoft-Windows-Sysmon/Operational", "computer": "fs03vuln.offsec.lan", "severityValue": "INFORMATION", "message": "Registry value set:\nRuleName: technique_id=T1047,technique_name=Windows Management Instrumentation\nEventType: SetValue\nUtcTime: 2021-11-08 10:26:55.123\nProcessGuid: {a57649d1-1303-6179-d9c8-010000000000}\nProcessId: 1508\nImage: C:\\Windows\\system32\\wbem\\wmiprvse.exe\nTargetObject: HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\AutoReboot\nDetails: DWORD (0x00000001)\nUser: %9"}, "eventdata": {"ruleName": "technique_id=T1047,technique_name=Windows Management Instrumentation", "eventType": "SetValue", "utcTime": "2021-11-08 10:26:55.123", "processGuid": "{a57649d1-1303-6179-d9c8-010000000000}", "processId": "1508", "image": "C:\\Windows\\system32\\wbem\\wmiprvse.exe", "targetObject": "HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\AutoReboot", "details": "DWORD (0x00000001)"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Sysmon", "providerGuid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}", "eventID": "13", "version": "2", "level": "4", "task": "13", "opcode": "0", "keywords": "0x8000000000000000", "systemTime": "2021-11-08T10:26:55.1394153Z", "eventRecordID": "44695", "processID": "1068", "threadID": "1628", "channel": "Microsoft-Windows-Sysmon/Operational", "computer": "fs03vuln.offsec.lan", "severityValue": "INFORMATION", "message": "Registry value set:\nRuleName: technique_id=T1047,technique_name=Windows Management Instrumentation\nEventType: SetValue\nUtcTime: 2021-11-08 10:26:55.123\nProcessGuid: {a57649d1-1303-6179-d9c8-010000000000}\nProcessId: 1508\nImage: C:\\Windows\\system32\\wbem\\wmiprvse.exe\nTargetObject: HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\DumpFile\nDetails: 87,105,110,100,111,119,115,32,73,80,32,67,111,110,102,105,103,117,114,97,116,105,111,110,13,10,13,10,32,32,32,72,111,115,116,32,78,97,109,101,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,102,115,48,51,118,117,108,110,13,10,32,32,32,80,114,105,109,97,114,121,32,68,110,115,32,83,117,102,102,105,120,32,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,111,102,102,115,101,99,46,108,97,110,13,10,32,32,32,78,111,100,101,32,84,121,112,101,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,72,121,98,114,105,100,13,10,32,32,32,73,80,32,82,111,117,116,105,110,103,32,69,110,97,98,108,101,100,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,78,111,13,10,32,32,32,87,73,78,83,32,80,114,111,120,121,32,69,110,97,98,108,101,100,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,78,111,13,10,32,32,32,68,78,83,32,83,117,102,102,105,120,32,83,101,97,114,99,104,32,76,105,115,116,46,32,46,32,46,32,46,32,46,32,46,32,58,32,111,102,102,115,101,99,46,108,97,110,13,10,13,10,69,116,104,101,114,110,101,116,32,97,100,97,112,116,101,114,32,69,116,104,101,114,110,101,116,48,58,13,10,13,10,32,32,32,67,111,110,110,101,99,116,105,111,110,45,115,112,101,99,105,102,105,99,32,68,78,83,32,83,117,102,102,105,120,32,32,46,32,58,32,13,10,32,32,32,68,101,115,99,114,105,112,116,105,111,110,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,73,110,116,101,108,40,82,41,32,56,50,53,55,52,76,32,71,105,103,97,98,105,116,32,78,101,116,119,111,114,107,32,67,111,110,110,101,99,116,105,111,110,13,10,32,32,32,80,104,121,115,105,99,97,108,32,65,100,100,114,101,115,115,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,48,48,45,53,48,45,53,54,45,57,55,45,50,66,45,55,55,13,10,32,32,32,68,72,67,80,32,69,110,97,98,108,101,100,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,78,111,13,10,32,32,32,65,117,116,111,99,111,110,102,105,103,117,114,97,116,105,111,110,32,69,110,97,98,108,101,100,32,46,32,46,32,46,32,46,32,58,32,89,101,115,13,10,32,32,32,76,105,110,107,45,108,111,99,97,108,32,73,80,118,54,32,65,100,100,114,101,115,115,32,46,32,46,32,46,32,46,32,46,32,58,32,102,101,56,48,58,58,99,48,98,100,58,54,57,54,99,58,51,57,54,48,58,97,49,98,49,37,49,50,40,80,114,101,102,101,114,114,101,100,41,32,13,10,32,32,32,73,80,118,52,32,65,100,100,114,101,115,115,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,49,48,46,50,51,46,52,50,46,51,56,40,80,114,101,102,101,114,114,101,100,41,32,13,10,32,32,32,83,117,98,110,101,116,32,77,97,115,107,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,50,53,53,46,50,53,53,46,50,53,53,46,48,13,10,32,32,32,68,101,102,97,117,108,116,32,71,97,116,101,119,97,121,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,49,48,46,50,51,46,52,50,46,49,13,10,32,32,32,68,72,67,80,118,54,32,73,65,73,68,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,51,48,50,48,49,48,52,53,52,13,10,32,32,32,68,72,67,80,118,54,32,67,108,105,101,110,116,32,68,85,73,68,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,48,48,45,48,49,45,48,48,45,48,49,45,50,54,45,52,54,45,50,56,45,65,68,45,48,48,45,53,48,45,53,54,45,57,55,45,50,66,45,55,55,13,10,32,32,32,68,78,83,32,83,101,114,118,101,114,115,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,49,48,46,50,51,46,52,50,46,49,48,13,10,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,49,48,46,50,51,46,52,50,46,49,49,13,10,32,32,32,78,101,116,66,73,79,83,32,111,118,101,114,32,84,99,112,105,112,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,69,110,97,98,108,101,100,13,10,13,10,84,117,110,110,101,108,32,97,100,97,112,116,101,114,32,105,115,97,116,97,112,46,123,68,54,56,57,48,67,54,52,45,54,67,56,55,45,52,48,54,65,45,65,69,66,56,45,69,51,51,70,53,52,69,53,66,67,56,50,125,58,13,10,13,10,32,32,32,77,101,100,105,97,32,83,116,97,116,101,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,77,101,100,105,97,32,100,105,115,99,111,110,110,101,99,116,101,100,13,10,32,32,32,67,111,110,110,101,99,116,105,111,110,45,115,112,101,99,105,102,105,99,32,68,78,83,32,83,117,102,102,105,120,32,32,46,32,58,32,13,10,32,32,32,68,101,115,99,114,105,112,116,105,111,110,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,77,105,99,114,111,115,111,102,116,32,73,83,65,84,65,80,32,65,100,97,112,116,101,114,13,10,32,32,32,80,104,121,115,105,99,97,108,32,65,100,100,114,101,115,115,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,48,48,45,48,48,45,48,48,45,48,48,45,48,48,45,48,48,45,48,48,45,69,48,13,10,32,32,32,68,72,67,80,32,69,110,97,98,108,101,100,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,78,111,13,10,32,32,32,65,117,116,111,99,111,110,102,105,103,117,114,97,116,105,111,110,32,69,110,97,98,108,101,100,32,46,32,46,32,46,32,46,32,58,32,89,101,115\nUser: %9"}, "eventdata": {"ruleName": "technique_id=T1047,technique_name=Windows Management Instrumentation", "eventType": "SetValue", "utcTime": "2021-11-08 10:26:55.123", "processGuid": "{a57649d1-1303-6179-d9c8-010000000000}", "processId": "1508", "image": "C:\\Windows\\system32\\wbem\\wmiprvse.exe", "targetObject": "HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\DumpFile", "details": "87,105,110,100,111,119,115,32,73,80,32,67,111,110,102,105,103,117,114,97,116,105,111,110,13,10,13,10,32,32,32,72,111,115,116,32,78,97,109,101,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,102,115,48,51,118,117,108,110,13,10,32,32,32,80,114,105,109,97,114,121,32,68,110,115,32,83,117,102,102,105,120,32,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,111,102,102,115,101,99,46,108,97,110,13,10,32,32,32,78,111,100,101,32,84,121,112,101,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,72,121,98,114,105,100,13,10,32,32,32,73,80,32,82,111,117,116,105,110,103,32,69,110,97,98,108,101,100,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,78,111,13,10,32,32,32,87,73,78,83,32,80,114,111,120,121,32,69,110,97,98,108,101,100,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,78,111,13,10,32,32,32,68,78,83,32,83,117,102,102,105,120,32,83,101,97,114,99,104,32,76,105,115,116,46,32,46,32,46,32,46,32,46,32,46,32,58,32,111,102,102,115,101,99,46,108,97,110,13,10,13,10,69,116,104,101,114,110,101,116,32,97,100,97,112,116,101,114,32,69,116,104,101,114,110,101,116,48,58,13,10,13,10,32,32,32,67,111,110,110,101,99,116,105,111,110,45,115,112,101,99,105,102,105,99,32,68,78,83,32,83,117,102,102,105,120,32,32,46,32,58,32,13,10,32,32,32,68,101,115,99,114,105,112,116,105,111,110,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,73,110,116,101,108,40,82,41,32,56,50,53,55,52,76,32,71,105,103,97,98,105,116,32,78,101,116,119,111,114,107,32,67,111,110,110,101,99,116,105,111,110,13,10,32,32,32,80,104,121,115,105,99,97,108,32,65,100,100,114,101,115,115,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,48,48,45,53,48,45,53,54,45,57,55,45,50,66,45,55,55,13,10,32,32,32,68,72,67,80,32,69,110,97,98,108,101,100,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,78,111,13,10,32,32,32,65,117,116,111,99,111,110,102,105,103,117,114,97,116,105,111,110,32,69,110,97,98,108,101,100,32,46,32,46,32,46,32,46,32,58,32,89,101,115,13,10,32,32,32,76,105,110,107,45,108,111,99,97,108,32,73,80,118,54,32,65,100,100,114,101,115,115,32,46,32,46,32,46,32,46,32,46,32,58,32,102,101,56,48,58,58,99,48,98,100,58,54,57,54,99,58,51,57,54,48,58,97,49,98,49,37,49,50,40,80,114,101,102,101,114,114,101,100,41,32,13,10,32,32,32,73,80,118,52,32,65,100,100,114,101,115,115,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,49,48,46,50,51,46,52,50,46,51,56,40,80,114,101,102,101,114,114,101,100,41,32,13,10,32,32,32,83,117,98,110,101,116,32,77,97,115,107,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,50,53,53,46,50,53,53,46,50,53,53,46,48,13,10,32,32,32,68,101,102,97,117,108,116,32,71,97,116,101,119,97,121,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,49,48,46,50,51,46,52,50,46,49,13,10,32,32,32,68,72,67,80,118,54,32,73,65,73,68,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,51,48,50,48,49,48,52,53,52,13,10,32,32,32,68,72,67,80,118,54,32,67,108,105,101,110,116,32,68,85,73,68,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,48,48,45,48,49,45,48,48,45,48,49,45,50,54,45,52,54,45,50,56,45,65,68,45,48,48,45,53,48,45,53,54,45,57,55,45,50,66,45,55,55,13,10,32,32,32,68,78,83,32,83,101,114,118,101,114,115,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,49,48,46,50,51,46,52,50,46,49,48,13,10,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,49,48,46,50,51,46,52,50,46,49,49,13,10,32,32,32,78,101,116,66,73,79,83,32,111,118,101,114,32,84,99,112,105,112,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,69,110,97,98,108,101,100,13,10,13,10,84,117,110,110,101,108,32,97,100,97,112,116,101,114,32,105,115,97,116,97,112,46,123,68,54,56,57,48,67,54,52,45,54,67,56,55,45,52,48,54,65,45,65,69,66,56,45,69,51,51,70,53,52,69,53,66,67,56,50,125,58,13,10,13,10,32,32,32,77,101,100,105,97,32,83,116,97,116,101,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,77,101,100,105,97,32,100,105,115,99,111,110,110,101,99,116,101,100,13,10,32,32,32,67,111,110,110,101,99,116,105,111,110,45,115,112,101,99,105,102,105,99,32,68,78,83,32,83,117,102,102,105,120,32,32,46,32,58,32,13,10,32,32,32,68,101,115,99,114,105,112,116,105,111,110,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,77,105,99,114,111,115,111,102,116,32,73,83,65,84,65,80,32,65,100,97,112,116,101,114,13,10,32,32,32,80,104,121,115,105,99,97,108,32,65,100,100,114,101,115,115,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,48,48,45,48,48,45,48,48,45,48,48,45,48,48,45,48,48,45,48,48,45,69,48,13,10,32,32,32,68,72,67,80,32,69,110,97,98,108,101,100,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,46,32,58,32,78,111,13,10,32,32,32,65,117,116,111,99,111,110,102,105,103,117,114,97,116,105,111,110,32,69,110,97,98,108,101,100,32,46,32,46,32,46,32,46,32,58,32,89,101,115"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Sysmon", "providerGuid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}", "eventID": "13", "version": "2", "level": "4", "task": "13", "opcode": "0", "keywords": "0x8000000000000000", "systemTime": "2021-11-08T10:26:55.1394153Z", "eventRecordID": "44696", "processID": "1068", "threadID": "1628", "channel": "Microsoft-Windows-Sysmon/Operational", "computer": "fs03vuln.offsec.lan", "severityValue": "INFORMATION", "message": "Registry value set:\nRuleName: technique_id=T1047,technique_name=Windows Management Instrumentation\nEventType: SetValue\nUtcTime: 2021-11-08 10:26:55.123\nProcessGuid: {a57649d1-1303-6179-d9c8-010000000000}\nProcessId: 1508\nImage: C:\\Windows\\system32\\wbem\\wmiprvse.exe\nTargetObject: HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\MiniDumpDir\nDetails: %%SystemRoot%%\\Minidump\nUser: %9"}, "eventdata": {"ruleName": "technique_id=T1047,technique_name=Windows Management Instrumentation", "eventType": "SetValue", "utcTime": "2021-11-08 10:26:55.123", "processGuid": "{a57649d1-1303-6179-d9c8-010000000000}", "processId": "1508", "image": "C:\\Windows\\system32\\wbem\\wmiprvse.exe", "targetObject": "HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\MiniDumpDir", "details": "%%SystemRoot%%\\Minidump"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Sysmon", "providerGuid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}", "eventID": "13", "version": "2", "level": "4", "task": "13", "opcode": "0", "keywords": "0x8000000000000000", "systemTime": "2021-11-08T10:26:59.7909596Z", "eventRecordID": "44697", "processID": "1068", "threadID": "1628", "channel": "Microsoft-Windows-Sysmon/Operational", "computer": "fs03vuln.offsec.lan", "severityValue": "INFORMATION", "message": "Registry value set:\nRuleName: technique_id=T1047,technique_name=Windows Management Instrumentation\nEventType: SetValue\nUtcTime: 2021-11-08 10:26:59.790\nProcessGuid: {a57649d1-1303-6179-d9c8-010000000000}\nProcessId: 1508\nImage: C:\\Windows\\system32\\wbem\\wmiprvse.exe\nTargetObject: HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\LogEvent\nDetails: DWORD (0x00000001)\nUser: %9"}, "eventdata": {"ruleName": "technique_id=T1047,technique_name=Windows Management Instrumentation", "eventType": "SetValue", "utcTime": "2021-11-08 10:26:59.790", "processGuid": "{a57649d1-1303-6179-d9c8-010000000000}", "processId": "1508", "image": "C:\\Windows\\system32\\wbem\\wmiprvse.exe", "targetObject": "HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\LogEvent", "details": "DWORD (0x00000001)"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Sysmon", "providerGuid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}", "eventID": "13", "version": "2", "level": "4", "task": "13", "opcode": "0", "keywords": "0x8000000000000000", "systemTime": "2021-11-08T10:26:59.7909596Z", "eventRecordID": "44698", "processID": "1068", "threadID": "1628", "channel": "Microsoft-Windows-Sysmon/Operational", "computer": "fs03vuln.offsec.lan", "severityValue": "INFORMATION", "message": "Registry value set:\nRuleName: technique_id=T1047,technique_name=Windows Management Instrumentation\nEventType: SetValue\nUtcTime: 2021-11-08 10:26:59.790\nProcessGuid: {a57649d1-1303-6179-d9c8-010000000000}\nProcessId: 1508\nImage: C:\\Windows\\system32\\wbem\\wmiprvse.exe\nTargetObject: HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\SendAlert\nDetails: DWORD (0x00000000)\nUser: %9"}, "eventdata": {"ruleName": "technique_id=T1047,technique_name=Windows Management Instrumentation", "eventType": "SetValue", "utcTime": "2021-11-08 10:26:59.790", "processGuid": "{a57649d1-1303-6179-d9c8-010000000000}", "processId": "1508", "image": "C:\\Windows\\system32\\wbem\\wmiprvse.exe", "targetObject": "HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\SendAlert", "details": "DWORD (0x00000000)"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Sysmon", "providerGuid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}", "eventID": "13", "version": "2", "level": "4", "task": "13", "opcode": "0", "keywords": "0x8000000000000000", "systemTime": "2021-11-08T10:26:59.7909596Z", "eventRecordID": "44699", "processID": "1068", "threadID": "1628", "channel": "Microsoft-Windows-Sysmon/Operational", "computer": "fs03vuln.offsec.lan", "severityValue": "INFORMATION", "message": "Registry value set:\nRuleName: technique_id=T1047,technique_name=Windows Management Instrumentation\nEventType: SetValue\nUtcTime: 2021-11-08 10:26:59.790\nProcessGuid: {a57649d1-1303-6179-d9c8-010000000000}\nProcessId: 1508\nImage: C:\\Windows\\system32\\wbem\\wmiprvse.exe\nTargetObject: HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\CrashDumpEnabled\nDetails: DWORD (0x00000007)\nUser: %9"}, "eventdata": {"ruleName": "technique_id=T1047,technique_name=Windows Management Instrumentation", "eventType": "SetValue", "utcTime": "2021-11-08 10:26:59.790", "processGuid": "{a57649d1-1303-6179-d9c8-010000000000}", "processId": "1508", "image": "C:\\Windows\\system32\\wbem\\wmiprvse.exe", "targetObject": "HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\CrashDumpEnabled", "details": "DWORD (0x00000007)"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Sysmon", "providerGuid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}", "eventID": "13", "version": "2", "level": "4", "task": "13", "opcode": "0", "keywords": "0x8000000000000000", "systemTime": "2021-11-08T10:26:59.7909596Z", "eventRecordID": "44700", "processID": "1068", "threadID": "1628", "channel": "Microsoft-Windows-Sysmon/Operational", "computer": "fs03vuln.offsec.lan", "severityValue": "INFORMATION", "message": "Registry value set:\nRuleName: technique_id=T1047,technique_name=Windows Management Instrumentation\nEventType: SetValue\nUtcTime: 2021-11-08 10:26:59.790\nProcessGuid: {a57649d1-1303-6179-d9c8-010000000000}\nProcessId: 1508\nImage: C:\\Windows\\system32\\wbem\\wmiprvse.exe\nTargetObject: HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\Overwrite\nDetails: DWORD (0x00000001)\nUser: %9"}, "eventdata": {"ruleName": "technique_id=T1047,technique_name=Windows Management Instrumentation", "eventType": "SetValue", "utcTime": "2021-11-08 10:26:59.790", "processGuid": "{a57649d1-1303-6179-d9c8-010000000000}", "processId": "1508", "image": "C:\\Windows\\system32\\wbem\\wmiprvse.exe", "targetObject": "HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\Overwrite", "details": "DWORD (0x00000001)"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Sysmon", "providerGuid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}", "eventID": "13", "version": "2", "level": "4", "task": "13", "opcode": "0", "keywords": "0x8000000000000000", "systemTime": "2021-11-08T10:26:59.7909596Z", "eventRecordID": "44701", "processID": "1068", "threadID": "1628", "channel": "Microsoft-Windows-Sysmon/Operational", "computer": "fs03vuln.offsec.lan", "severityValue": "INFORMATION", "message": "Registry value set:\nRuleName: technique_id=T1047,technique_name=Windows Management Instrumentation\nEventType: SetValue\nUtcTime: 2021-11-08 10:26:59.790\nProcessGuid: {a57649d1-1303-6179-d9c8-010000000000}\nProcessId: 1508\nImage: C:\\Windows\\system32\\wbem\\wmiprvse.exe\nTargetObject: HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\KernelDumpOnly\nDetails: DWORD (0x00000000)\nUser: %9"}, "eventdata": {"ruleName": "technique_id=T1047,technique_name=Windows Management Instrumentation", "eventType": "SetValue", "utcTime": "2021-11-08 10:26:59.790", "processGuid": "{a57649d1-1303-6179-d9c8-010000000000}", "processId": "1508", "image": "C:\\Windows\\system32\\wbem\\wmiprvse.exe", "targetObject": "HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\KernelDumpOnly", "details": "DWORD (0x00000000)"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Sysmon", "providerGuid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}", "eventID": "13", "version": "2", "level": "4", "task": "13", "opcode": "0", "keywords": "0x8000000000000000", "systemTime": "2021-11-08T10:26:59.7909596Z", "eventRecordID": "44702", "processID": "1068", "threadID": "1628", "channel": "Microsoft-Windows-Sysmon/Operational", "computer": "fs03vuln.offsec.lan", "severityValue": "INFORMATION", "message": "Registry value set:\nRuleName: technique_id=T1047,technique_name=Windows Management Instrumentation\nEventType: SetValue\nUtcTime: 2021-11-08 10:26:59.790\nProcessGuid: {a57649d1-1303-6179-d9c8-010000000000}\nProcessId: 1508\nImage: C:\\Windows\\system32\\wbem\\wmiprvse.exe\nTargetObject: HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\AutoReboot\nDetails: DWORD (0x00000001)\nUser: %9"}, "eventdata": {"ruleName": "technique_id=T1047,technique_name=Windows Management Instrumentation", "eventType": "SetValue", "utcTime": "2021-11-08 10:26:59.790", "processGuid": "{a57649d1-1303-6179-d9c8-010000000000}", "processId": "1508", "image": "C:\\Windows\\system32\\wbem\\wmiprvse.exe", "targetObject": "HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\AutoReboot", "details": "DWORD (0x00000001)"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Sysmon", "providerGuid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}", "eventID": "13", "version": "2", "level": "4", "task": "13", "opcode": "0", "keywords": "0x8000000000000000", "systemTime": "2021-11-08T10:26:59.7909596Z", "eventRecordID": "44703", "processID": "1068", "threadID": "1628", "channel": "Microsoft-Windows-Sysmon/Operational", "computer": "fs03vuln.offsec.lan", "severityValue": "INFORMATION", "message": "Registry value set:\nRuleName: technique_id=T1047,technique_name=Windows Management Instrumentation\nEventType: SetValue\nUtcTime: 2021-11-08 10:26:59.790\nProcessGuid: {a57649d1-1303-6179-d9c8-010000000000}\nProcessId: 1508\nImage: C:\\Windows\\system32\\wbem\\wmiprvse.exe\nTargetObject: HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\DumpFile\nDetails: %%SystemRoot%%\\MEMORY.DMP\nUser: %9"}, "eventdata": {"ruleName": "technique_id=T1047,technique_name=Windows Management Instrumentation", "eventType": "SetValue", "utcTime": "2021-11-08 10:26:59.790", "processGuid": "{a57649d1-1303-6179-d9c8-010000000000}", "processId": "1508", "image": "C:\\Windows\\system32\\wbem\\wmiprvse.exe", "targetObject": "HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\DumpFile", "details": "%%SystemRoot%%\\MEMORY.DMP"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Sysmon", "providerGuid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}", "eventID": "13", "version": "2", "level": "4", "task": "13", "opcode": "0", "keywords": "0x8000000000000000", "systemTime": "2021-11-08T10:26:59.7909596Z", "eventRecordID": "44704", "processID": "1068", "threadID": "1628", "channel": "Microsoft-Windows-Sysmon/Operational", "computer": "fs03vuln.offsec.lan", "severityValue": "INFORMATION", "message": "Registry value set:\nRuleName: technique_id=T1047,technique_name=Windows Management Instrumentation\nEventType: SetValue\nUtcTime: 2021-11-08 10:26:59.790\nProcessGuid: {a57649d1-1303-6179-d9c8-010000000000}\nProcessId: 1508\nImage: C:\\Windows\\system32\\wbem\\wmiprvse.exe\nTargetObject: HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\MiniDumpDir\nDetails: %%SystemRoot%%\\Minidump\nUser: %9"}, "eventdata": {"ruleName": "technique_id=T1047,technique_name=Windows Management Instrumentation", "eventType": "SetValue", "utcTime": "2021-11-08 10:26:59.790", "processGuid": "{a57649d1-1303-6179-d9c8-010000000000}", "processId": "1508", "image": "C:\\Windows\\system32\\wbem\\wmiprvse.exe", "targetObject": "HKLM\\System\\CurrentControlSet\\Control\\CrashControl\\MiniDumpDir", "details": "%%SystemRoot%%\\Minidump"}}}'''
        ]

        responses = send_multiple_logs(logs, location="stdin", log_format="json")

        # Ensure we receive a response for each log sent
        self.assertEqual(len(responses), len(logs))

        for _, response in enumerate(responses):
            self.assertEqual(response.status, LogtestStatus.RuleMatch)
            self.assertEqual(response.decoder, 'json')

            # Example: Set expected Wazuh rule ID and level when analyzing logs
            # expected_rule_id = None  # Replace with actual rule ID
            # expected_rule_level = None  # Replace with actual rule level

            # self.assertEqual(response.rule_id, expected_rule_id)
            # self.assertEqual(response.rule_level, expected_rule_level)

        # TODO: Write the expected result as test cases when the logs are analyzed by Wazuh.
        self.fail("Test not implemented yet. Define expected results.")

    def test_id19_20_wmi_registration_via_powerlurk(self) -> None:
        # Logs extracted from EVTX file
        logs = [
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Sysmon", "providerGuid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}", "eventID": "20", "version": "3", "level": "4", "task": "20", "opcode": "0", "keywords": "0x8000000000000000", "systemTime": "2021-06-09T19:29:58.2398438Z", "eventRecordID": "49256", "processID": "1732", "threadID": "4840", "channel": "Microsoft-Windows-Sysmon/Operational", "computer": "fs01.offsec.lan", "severityValue": "INFORMATION", "message": "WmiEventConsumer activity detected:\nRuleName: technique_id=T1047,technique_name=Windows Management Instrumentation\nEventType: WmiConsumerEvent\nUtcTime: 2021-06-09 19:29:58.224\nOperation: Created\nUser: OFFSEC\\admmig\nName:  \"Evil\"\nType: Command Line\nDestination:  \"cmd.exe /c echo %ProcessId% >> c:\\\\\\\\temp\\\\\\\\log.txt\""}, "eventdata": {"ruleName": "technique_id=T1047,technique_name=Windows Management Instrumentation", "eventType": "WmiConsumerEvent", "utcTime": "2021-06-09 19:29:58.224", "operation": "Created", "user": "OFFSEC\\admmig", "name": "\"Evil\"", "type": "Command Line", "destination": "\"cmd.exe /c echo %ProcessId% >> c:\\\\\\\\temp\\\\\\\\log.txt\""}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Sysmon", "providerGuid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}", "eventID": "19", "version": "3", "level": "4", "task": "19", "opcode": "0", "keywords": "0x8000000000000000", "systemTime": "2021-06-09T19:29:58.2403532Z", "eventRecordID": "49257", "processID": "1732", "threadID": "4840", "channel": "Microsoft-Windows-Sysmon/Operational", "computer": "fs01.offsec.lan", "severityValue": "INFORMATION", "message": "WmiEventFilter activity detected:\nRuleName: technique_id=T1047,technique_name=Windows Management Instrumentation\nEventType: WmiFilterEvent\nUtcTime: 2021-06-09 19:29:58.239\nOperation: Created\nUser: OFFSEC\\admmig\nEventNamespace:  \"root/cimv2\"\nName:  \"Evil\"\nQuery:  \"SELECT * FROM Win32_ProcessStartTrace WHERE ProcessName='notepad.exe'\""}, "eventdata": {"ruleName": "technique_id=T1047,technique_name=Windows Management Instrumentation", "eventType": "WmiFilterEvent", "utcTime": "2021-06-09 19:29:58.239", "operation": "Created", "user": "OFFSEC\\admmig", "eventNamespace": "\"root/cimv2\"", "name": "\"Evil\"", "query": "\"SELECT * FROM Win32_ProcessStartTrace WHERE ProcessName='notepad.exe'\""}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Sysmon", "providerGuid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}", "eventID": "19", "version": "3", "level": "4", "task": "19", "opcode": "0", "keywords": "0x8000000000000000", "systemTime": "2021-06-09T19:29:58.3924518Z", "eventRecordID": "49258", "processID": "1732", "threadID": "4840", "channel": "Microsoft-Windows-Sysmon/Operational", "computer": "fs01.offsec.lan", "severityValue": "INFORMATION", "message": "WmiEventFilter activity detected:\nRuleName: technique_id=T1047,technique_name=Windows Management Instrumentation\nEventType: WmiFilterEvent\nUtcTime: 2021-06-09 19:29:58.392\nOperation: Created\nUser: OFFSEC\\admmig\nEventNamespace:  \"root/cimv2\"\nName:  \"Evil\"\nQuery:  \"SELECT * FROM Win32_ProcessStartTrace WHERE ProcessName='notepad.exe'\""}, "eventdata": {"ruleName": "technique_id=T1047,technique_name=Windows Management Instrumentation", "eventType": "WmiFilterEvent", "utcTime": "2021-06-09 19:29:58.392", "operation": "Created", "user": "OFFSEC\\admmig", "eventNamespace": "\"root/cimv2\"", "name": "\"Evil\"", "query": "\"SELECT * FROM Win32_ProcessStartTrace WHERE ProcessName='notepad.exe'\""}}}'''
        ]

        responses = send_multiple_logs(logs, location="stdin", log_format="json")

        # Ensure we receive a response for each log sent
        self.assertEqual(len(responses), len(logs))

        for _, response in enumerate(responses):
            self.assertEqual(response.status, LogtestStatus.RuleMatch)
            self.assertEqual(response.decoder, 'json')

            # Example: Set expected Wazuh rule ID and level when analyzing logs
            # expected_rule_id = None  # Replace with actual rule ID
            # expected_rule_level = None  # Replace with actual rule level

            # self.assertEqual(response.rule_id, expected_rule_id)
            # self.assertEqual(response.rule_level, expected_rule_level)

        # TODO: Write the expected result as test cases when the logs are analyzed by Wazuh.
        self.fail("Test not implemented yet. Define expected results.")

    def test_id4688_netsh_helper_dll(self) -> None:
        # Logs extracted from EVTX file
        logs = [
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Eventlog", "providerGuid": "{fc65ddd8-d6ef-4962-83d5-6e5cfe9ce148}", "eventID": "1102", "version": "0", "level": "4", "task": "104", "opcode": "0", "keywords": "0x4020000000000000", "systemTime": "2021-05-22T21:56:57.6859325Z", "eventRecordID": "1869790", "processID": "984", "threadID": "368", "channel": "Security", "computer": "fs01.offsec.lan", "severityValue": "INFORMATION", "message": "The audit log was cleared.\nSubject:\n\tSecurity ID:\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\tadmmig\n\tDomain Name:\tOFFSEC\n\tLogon ID:\t0x75494"}, "eventdata": {}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "4688", "version": "2", "level": "0", "task": "13312", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-05-22T21:57:11.8420321Z", "eventRecordID": "1869791", "processID": "4", "threadID": "2132", "channel": "Security", "computer": "fs01.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "A new process has been created.\n\nCreator Subject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x75494\n\nTarget Subject:\n\tSecurity ID:\t\tS-1-0-0\n\tAccount Name:\t\t-\n\tAccount Domain:\t\t-\n\tLogon ID:\t\t0x0\n\nProcess Information:\n\tNew Process ID:\t\t0xd28\n\tNew Process Name:\tC:\\Windows\\System32\\netsh.exe\n\tToken Elevation Type:\t%%1937\n\tMandatory Label:\t\tS-1-16-12288\n\tCreator Process ID:\t0x1254\n\tCreator Process Name:\tC:\\Windows\\System32\\cmd.exe\n\tProcess Command Line:\tnetsh  add helper  mimikatz.exe\n\nToken Elevation Type indicates the type of token that was assigned to the new process in accordance with User Account Control policy.\n\nType 1 is a full token with no privileges removed or groups disabled.  A full token is only used if User Account Control is disabled or if the user is the built-in Administrator account or a service account.\n\nType 2 is an elevated token with no privileges removed or groups disabled.  An elevated token is used when User Account Control is enabled and the user chooses to start the program using Run as administrator.  An elevated token is also used when an application is configured to always require administrative privilege or to always require maximum privilege, and the user is a member of the Administrators group.\n\nType 3 is a limited token with administrative privileges removed and administrative groups disabled.  The limited token is used when User Account Control is enabled, the application does not require administrative privilege, and the user does not choose to start the program using Run as administrator."}, "eventdata": {"subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x75494", "newProcessId": "0xd28", "newProcessName": "C:\\Windows\\System32\\netsh.exe", "tokenElevationType": "%%1937", "processId": "0x1254", "commandLine": "netsh  add helper  mimikatz.exe", "targetUserSid": "S-1-0-0", "targetLogonId": "0x0", "parentProcessName": "C:\\Windows\\System32\\cmd.exe", "mandatoryLabel": "S-1-16-12288"}}}'''
        ]

        responses = send_multiple_logs(logs, location="stdin", log_format="json")

        # Ensure we receive a response for each log sent
        self.assertEqual(len(responses), len(logs))

        for _, response in enumerate(responses):
            self.assertEqual(response.status, LogtestStatus.RuleMatch)
            self.assertEqual(response.decoder, 'json')

            # Example: Set expected Wazuh rule ID and level when analyzing logs
            # expected_rule_id = None  # Replace with actual rule ID
            # expected_rule_level = None  # Replace with actual rule level

            # self.assertEqual(response.rule_id, expected_rule_id)
            # self.assertEqual(response.rule_level, expected_rule_level)

        # TODO: Write the expected result as test cases when the logs are analyzed by Wazuh.
        self.fail("Test not implemented yet. Define expected results.")

    def test_id5136_adminsdholder_backdoor_obfuscation_via_localizationdisplayid(self) -> None:
        # Logs extracted from EVTX file
        logs = [
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "5136", "version": "0", "level": "0", "task": "14081", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-03-27T14:20:03.0328006Z", "eventRecordID": "125918254", "processID": "560", "threadID": "2248", "channel": "Security", "computer": "rootdc1.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "A directory service object was modified.\n\t\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x1B790F9\n\nDirectory Service:\n\tName:\toffsec.lan\n\tType:\tActive Directory Domain Services\n\t\nObject:\n\tDN:\tCN=User-Force-Change-Password,CN=Extended-Rights,CN=Configuration,DC=offsec,DC=lan\n\tGUID:\t{16bfbcba-6758-4cde-bdeb-8e3f661e271e}\n\tClass:\tcontrolAccessRight\n\t\nAttribute:\n\tLDAP Display Name:\tlocalizationDisplayId\n\tSyntax (OID):\t2.5.5.9\n\tValue:\t3\n\t\nOperation:\n\tType:\tValue Deleted\n\tCorrelation ID:\t{c37c1925-c30d-47a0-8f8f-f7d569c924a2}\n\tApplication Correlation ID:\t-"}, "eventdata": {"opCorrelationID": "{c37c1925-c30d-47a0-8f8f-f7d569c924a2}", "subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x1b790f9", "dSName": "offsec.lan", "dSType": "%%14676", "objectDN": "CN=User-Force-Change-Password,CN=Extended-Rights,CN=Configuration,DC=offsec,DC=lan", "objectGUID": "{16bfbcba-6758-4cde-bdeb-8e3f661e271e}", "objectClass": "controlAccessRight", "attributeLDAPDisplayName": "localizationDisplayId", "attributeSyntaxOID": "2.5.5.9", "attributeValue": "3", "operationType": "%%14675"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "5136", "version": "0", "level": "0", "task": "14081", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-03-27T14:20:03.0331282Z", "eventRecordID": "125918255", "processID": "560", "threadID": "3104", "channel": "Security", "computer": "rootdc1.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "A directory service object was modified.\n\t\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x1B790F9\n\nDirectory Service:\n\tName:\toffsec.lan\n\tType:\tActive Directory Domain Services\n\t\nObject:\n\tDN:\tCN=User-Force-Change-Password,CN=Extended-Rights,CN=Configuration,DC=offsec,DC=lan\n\tGUID:\t{16bfbcba-6758-4cde-bdeb-8e3f661e271e}\n\tClass:\tcontrolAccessRight\n\t\nAttribute:\n\tLDAP Display Name:\tlocalizationDisplayId\n\tSyntax (OID):\t2.5.5.9\n\tValue:\t2\n\t\nOperation:\n\tType:\tValue Added\n\tCorrelation ID:\t{c37c1925-c30d-47a0-8f8f-f7d569c924a2}\n\tApplication Correlation ID:\t-"}, "eventdata": {"opCorrelationID": "{c37c1925-c30d-47a0-8f8f-f7d569c924a2}", "subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x1b790f9", "dSName": "offsec.lan", "dSType": "%%14676", "objectDN": "CN=User-Force-Change-Password,CN=Extended-Rights,CN=Configuration,DC=offsec,DC=lan", "objectGUID": "{16bfbcba-6758-4cde-bdeb-8e3f661e271e}", "objectClass": "controlAccessRight", "attributeLDAPDisplayName": "localizationDisplayId", "attributeSyntaxOID": "2.5.5.9", "attributeValue": "2", "operationType": "%%14674"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "5136", "version": "0", "level": "0", "task": "14081", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-03-27T14:28:44.3799778Z", "eventRecordID": "125921360", "processID": "560", "threadID": "2480", "channel": "Security", "computer": "rootdc1.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "A directory service object was modified.\n\t\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x1B790F9\n\nDirectory Service:\n\tName:\toffsec.lan\n\tType:\tActive Directory Domain Services\n\t\nObject:\n\tDN:\tCN=User-Force-Change-Password,CN=Extended-Rights,CN=Configuration,DC=offsec,DC=lan\n\tGUID:\t{16bfbcba-6758-4cde-bdeb-8e3f661e271e}\n\tClass:\tcontrolAccessRight\n\t\nAttribute:\n\tLDAP Display Name:\tlocalizationDisplayId\n\tSyntax (OID):\t2.5.5.9\n\tValue:\t2\n\t\nOperation:\n\tType:\tValue Deleted\n\tCorrelation ID:\t{faeca81d-02c2-4669-b2fc-80bec0c7e977}\n\tApplication Correlation ID:\t-"}, "eventdata": {"opCorrelationID": "{faeca81d-02c2-4669-b2fc-80bec0c7e977}", "subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x1b790f9", "dSName": "offsec.lan", "dSType": "%%14676", "objectDN": "CN=User-Force-Change-Password,CN=Extended-Rights,CN=Configuration,DC=offsec,DC=lan", "objectGUID": "{16bfbcba-6758-4cde-bdeb-8e3f661e271e}", "objectClass": "controlAccessRight", "attributeLDAPDisplayName": "localizationDisplayId", "attributeSyntaxOID": "2.5.5.9", "attributeValue": "2", "operationType": "%%14675"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "5136", "version": "0", "level": "0", "task": "14081", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-03-27T14:28:44.3802378Z", "eventRecordID": "125921361", "processID": "560", "threadID": "5888", "channel": "Security", "computer": "rootdc1.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "A directory service object was modified.\n\t\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x1B790F9\n\nDirectory Service:\n\tName:\toffsec.lan\n\tType:\tActive Directory Domain Services\n\t\nObject:\n\tDN:\tCN=User-Force-Change-Password,CN=Extended-Rights,CN=Configuration,DC=offsec,DC=lan\n\tGUID:\t{16bfbcba-6758-4cde-bdeb-8e3f661e271e}\n\tClass:\tcontrolAccessRight\n\t\nAttribute:\n\tLDAP Display Name:\tlocalizationDisplayId\n\tSyntax (OID):\t2.5.5.9\n\tValue:\t3\n\t\nOperation:\n\tType:\tValue Added\n\tCorrelation ID:\t{faeca81d-02c2-4669-b2fc-80bec0c7e977}\n\tApplication Correlation ID:\t-"}, "eventdata": {"opCorrelationID": "{faeca81d-02c2-4669-b2fc-80bec0c7e977}", "subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x1b790f9", "dSName": "offsec.lan", "dSType": "%%14676", "objectDN": "CN=User-Force-Change-Password,CN=Extended-Rights,CN=Configuration,DC=offsec,DC=lan", "objectGUID": "{16bfbcba-6758-4cde-bdeb-8e3f661e271e}", "objectClass": "controlAccessRight", "attributeLDAPDisplayName": "localizationDisplayId", "attributeSyntaxOID": "2.5.5.9", "attributeValue": "3", "operationType": "%%14674"}}}'''
        ]

        responses = send_multiple_logs(logs, location="stdin", log_format="json")

        # Ensure we receive a response for each log sent
        self.assertEqual(len(responses), len(logs))

        for _, response in enumerate(responses):
            self.assertEqual(response.status, LogtestStatus.RuleMatch)
            self.assertEqual(response.decoder, 'json')

            # Example: Set expected Wazuh rule ID and level when analyzing logs
            # expected_rule_id = None  # Replace with actual rule ID
            # expected_rule_level = None  # Replace with actual rule level

            # self.assertEqual(response.rule_id, expected_rule_id)
            # self.assertEqual(response.rule_level, expected_rule_level)

        # TODO: Write the expected result as test cases when the logs are analyzed by Wazuh.
        self.fail("Test not implemented yet. Define expected results.")

    def test_id5136_adminsdholder_permissions_changed(self) -> None:
        # Logs extracted from EVTX file
        logs = [
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "5136", "version": "0", "level": "0", "task": "14081", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-02-22T22:06:26.7927134Z", "eventRecordID": "111646766", "processID": "556", "threadID": "4060", "channel": "Security", "computer": "rootdc1.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "A directory service object was modified.\n\t\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x24D81A03\n\nDirectory Service:\n\tName:\toffsec.lan\n\tType:\tActive Directory Domain Services\n\t\nObject:\n\tDN:\tCN=AdminSDHolder,CN=System,DC=offsec,DC=lan\n\tGUID:\t{dc8cdce1-2076-47c1-8ec2-3d0799cd324d}\n\tClass:\tcontainer\n\t\nAttribute:\n\tLDAP Display Name:\tnTSecurityDescriptor\n\tSyntax (OID):\t2.5.5.15\n\tValue:\tO:DAG:DAD:PAI(OD;CI;WP;f3a64788-5306-11d1-a9c5-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CIIO;CCDCLC;c975c901-6cea-4b6f-8319-d67f45449506;4828cc14-1437-45bc-9b07-ad6f015e5f28;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CIIO;CCDCLC;c975c901-6cea-4b6f-8319-d67f45449506;bf967aba-0de6-11d0-a285-00aa003049e2;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;;RP;4c164200-20c0-11d0-a768-00aa006e0529;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;;RP;4c164200-20c0-11d0-a768-00aa006e0529;bf967aba-0de6-11d0-a285-00aa003049e2;RU)(OA;;RP;5f202010-79a5-11d0-9020-00c04fc2d4cf;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;;RP;bc0ac240-79a9-11d0-9020-00c04fc2d4cf;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;;RP;bc0ac240-79a9-11d0-9020-00c04fc2d4cf;bf967aba-0de6-11d0-a285-00aa003049e2;RU)(OA;;RP;59ba2f42-79a2-11d0-9020-00c04fc2d3cf;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;;RP;59ba2f42-79a2-11d0-9020-00c04fc2d3cf;bf967aba-0de6-11d0-a285-00aa003049e2;RU)(OA;;RP;037088f8-0ae1-11d2-b422-00a0c968f939;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;;RP;037088f8-0ae1-11d2-b422-00a0c968f939;bf967aba-0de6-11d0-a285-00aa003049e2;RU)(OA;;CR;1131f6ab-9c07-11d1-f79f-00c04fc2dcd2;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;;RPWP;bf967a7f-0de6-11d0-a285-00aa003049e2;;CA)(OA;CI;RP;4c164200-20c0-11d0-a768-00aa006e0529;;S-1-5-21-4230534742-2542757381-3142984815-1199)(OA;CI;RP;b1b3a417-ec55-4191-b327-b72e33e38af2;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;RP;9a7ad945-ca53-11d1-bbd0-0080c76670c0;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;RP;bf967a68-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;RP;1f298a89-de98-47b8-b5cd-572ad53d267e;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;RP;bf967991-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;RP;5fd424a1-1262-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;bf967a06-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;bf967a06-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;3e74f60e-3e73-11d1-a9c0-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;3e74f60e-3e73-11d1-a9c0-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;b1b3a417-ec55-4191-b327-b72e33e38af2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;b1b3a417-ec55-4191-b327-b72e33e38af2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;bf96791a-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;bf96791a-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;9a9a021e-4a5b-11d1-a9c3-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;934de926-b09e-11d2-aa06-00c04f8eedd8;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;5e353847-f36c-48be-a7f7-49685402503c;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;8d3bca50-1d7e-11d0-a081-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;bf967953-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;bf967953-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;e48d0154-bcf8-11d1-8702-00c04fb96050;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;275b2f54-982d-4dcd-b0ad-e53501445efb;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;bf967954-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;bf967954-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;bf967961-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;bf967961-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;5430e777-c3ea-4024-902e-dde192204669;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;6f606079-3a82-4c1b-8efb-dcc8c91d26fe;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;bf967a7f-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;614aea82-abc6-4dd0-a148-d67a59c72816;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;66437984-c3c5-498f-b269-987819ef484b;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;77b5b886-944a-11d1-aebd-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;a8df7489-c5ea-11d1-bbcb-0080c76670c0;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;a8df7489-c5ea-11d1-bbcb-0080c76670c0;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;1f298a89-de98-47b8-b5cd-572ad53d267e;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;1f298a89-de98-47b8-b5cd-572ad53d267e;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;f0f8ff9a-1191-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;f0f8ff9a-1191-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;f0f8ff9a-1191-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;2cc06e9d-6f7e-426a-8825-0215de176e11;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;5fd424a1-1262-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;5fd424a1-1262-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;3263e3b8-fd6b-4c60-87f2-34bdaa9d69eb;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;28630ebc-41d5-11d1-a9c1-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;28630ebc-41d5-11d1-a9c1-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;7cb4c7d3-8787-42b0-b438-3c5d479ad31e;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;CCDCLCRPWPLO;f0f8ffac-1191-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;CCDCLCRPWPLO;e8b2aff2-59a7-4eac-9a70-819adef701dd;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;CCDCLCSWRPWPDTLOCRSDRCWDWO;018849b0-a981-11d2-a9ff-00c04f8eedd8;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;CCDCLCSWRPWPDTLOCRSDRCWDWO;018849b0-a981-11d2-a9ff-00c04f8eedd8;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CIIO;CCDCLCSWRPWPDTLOCRSDRCWDWO;;c975c901-6cea-4b6f-8319-d67f45449506;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CIIO;CCDCLCSWRPWPDTLOCRSDRCWDWO;;f0f8ffac-1191-11d0-a060-00aa006c33ed;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CINPIO;RPWPLOSD;;e8b2aff2-59a7-4eac-9a70-819adef701dd;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;;RP;46a9b11d-60ae-405a-b7e8-ff8a58d456d2;;S-1-5-32-560)(OA;;RPWP;6db69a1c-9422-11d1-aebd-0000f80367c1;;S-1-5-32-561)(OA;;RPWP;5805bc62-bdc9-4428-a5e2-856a0f4c185e;;S-1-5-32-561)(OA;;LCRPLORC;;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;;LCRPLORC;;bf967aba-0de6-11d0-a285-00aa003049e2;RU)(OA;;CR;ab721a53-1e2f-11d0-9819-00aa0040529b;;WD)(OA;;CR;ab721a53-1e2f-11d0-9819-00aa0040529b;;PS)(OA;CI;RP;b1b3a417-ec55-4191-b327-b72e33e38af2;;NS)(OA;CI;RP;1f298a89-de98-47b8-b5cd-572ad53d267e;;AU)(OA;CI;RPWPCR;91e647de-d96f-4b70-9557-d63ff4f3ccd8;;PS)(A;;CCDCLCSWRPWPLOCRRCWDWO;;;DA)(A;;CCDCLCSWRPWPLOCRRCWDWO;;;S-1-5-21-4230534742-2542757381-3142984815-519)(A;CI;LCRPLORC;;;S-1-5-21-4230534742-2542757381-3142984815-1190)(A;CI;LCRPLORC;;;S-1-5-21-4230534742-2542757381-3142984815-1205)(A;;CCDCLCSWRPWPLOCRSDRCWDWO;;;BA)(A;;LCRPLORC;;;AU)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;SY)S:AI(AU;SA;WPWDWO;;;WD)(OU;CIIOIDSA;WP;f30e3bbe-9ff0-11d1-b603-0000f80367c1;bf967aa5-0de6-11d0-a285-00aa003049e2;WD)(OU;CIIOIDSA;WP;f30e3bbf-9ff0-11d1-b603-0000f80367c1;bf967aa5-0de6-11d0-a285-00aa003049e2;WD)(AU;CIIDSA;WPCRWDWO;;;WD)\n\t\nOperation:\n\tType:\tValue Deleted\n\tCorrelation ID:\t{9f6c1605-d0a4-4530-8624-8c2630d1cc21}\n\tApplication Correlation ID:\t-"}, "eventdata": {"opCorrelationID": "{9f6c1605-d0a4-4530-8624-8c2630d1cc21}", "subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x24d81a03", "dSName": "offsec.lan", "dSType": "%%14676", "objectDN": "CN=AdminSDHolder,CN=System,DC=offsec,DC=lan", "objectGUID": "{dc8cdce1-2076-47c1-8ec2-3d0799cd324d}", "objectClass": "container", "attributeLDAPDisplayName": "nTSecurityDescriptor", "attributeSyntaxOID": "2.5.5.15", "attributeValue": "O:DAG:DAD:PAI(OD;CI;WP;f3a64788-5306-11d1-a9c5-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CIIO;CCDCLC;c975c901-6cea-4b6f-8319-d67f45449506;4828cc14-1437-45bc-9b07-ad6f015e5f28;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CIIO;CCDCLC;c975c901-6cea-4b6f-8319-d67f45449506;bf967aba-0de6-11d0-a285-00aa003049e2;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;;RP;4c164200-20c0-11d0-a768-00aa006e0529;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;;RP;4c164200-20c0-11d0-a768-00aa006e0529;bf967aba-0de6-11d0-a285-00aa003049e2;RU)(OA;;RP;5f202010-79a5-11d0-9020-00c04fc2d4cf;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;;RP;bc0ac240-79a9-11d0-9020-00c04fc2d4cf;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;;RP;bc0ac240-79a9-11d0-9020-00c04fc2d4cf;bf967aba-0de6-11d0-a285-00aa003049e2;RU)(OA;;RP;59ba2f42-79a2-11d0-9020-00c04fc2d3cf;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;;RP;59ba2f42-79a2-11d0-9020-00c04fc2d3cf;bf967aba-0de6-11d0-a285-00aa003049e2;RU)(OA;;RP;037088f8-0ae1-11d2-b422-00a0c968f939;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;;RP;037088f8-0ae1-11d2-b422-00a0c968f939;bf967aba-0de6-11d0-a285-00aa003049e2;RU)(OA;;CR;1131f6ab-9c07-11d1-f79f-00c04fc2dcd2;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;;RPWP;bf967a7f-0de6-11d0-a285-00aa003049e2;;CA)(OA;CI;RP;4c164200-20c0-11d0-a768-00aa006e0529;;S-1-5-21-4230534742-2542757381-3142984815-1199)(OA;CI;RP;b1b3a417-ec55-4191-b327-b72e33e38af2;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;RP;9a7ad945-ca53-11d1-bbd0-0080c76670c0;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;RP;bf967a68-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;RP;1f298a89-de98-47b8-b5cd-572ad53d267e;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;RP;bf967991-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;RP;5fd424a1-1262-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;bf967a06-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;bf967a06-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;3e74f60e-3e73-11d1-a9c0-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;3e74f60e-3e73-11d1-a9c0-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;b1b3a417-ec55-4191-b327-b72e33e38af2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;b1b3a417-ec55-4191-b327-b72e33e38af2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;bf96791a-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;bf96791a-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;9a9a021e-4a5b-11d1-a9c3-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;934de926-b09e-11d2-aa06-00c04f8eedd8;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;5e353847-f36c-48be-a7f7-49685402503c;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;8d3bca50-1d7e-11d0-a081-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;bf967953-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;bf967953-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;e48d0154-bcf8-11d1-8702-00c04fb96050;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;275b2f54-982d-4dcd-b0ad-e53501445efb;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;bf967954-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;bf967954-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;bf967961-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;bf967961-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;5430e777-c3ea-4024-902e-dde192204669;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;6f606079-3a82-4c1b-8efb-dcc8c91d26fe;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;bf967a7f-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;614aea82-abc6-4dd0-a148-d67a59c72816;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;66437984-c3c5-498f-b269-987819ef484b;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;77b5b886-944a-11d1-aebd-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;a8df7489-c5ea-11d1-bbcb-0080c76670c0;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;a8df7489-c5ea-11d1-bbcb-0080c76670c0;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;1f298a89-de98-47b8-b5cd-572ad53d267e;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;1f298a89-de98-47b8-b5cd-572ad53d267e;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;f0f8ff9a-1191-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;f0f8ff9a-1191-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;f0f8ff9a-1191-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;2cc06e9d-6f7e-426a-8825-0215de176e11;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;5fd424a1-1262-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;5fd424a1-1262-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;3263e3b8-fd6b-4c60-87f2-34bdaa9d69eb;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;28630ebc-41d5-11d1-a9c1-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;28630ebc-41d5-11d1-a9c1-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;7cb4c7d3-8787-42b0-b438-3c5d479ad31e;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;CCDCLCRPWPLO;f0f8ffac-1191-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;CCDCLCRPWPLO;e8b2aff2-59a7-4eac-9a70-819adef701dd;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;CCDCLCSWRPWPDTLOCRSDRCWDWO;018849b0-a981-11d2-a9ff-00c04f8eedd8;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;CCDCLCSWRPWPDTLOCRSDRCWDWO;018849b0-a981-11d2-a9ff-00c04f8eedd8;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CIIO;CCDCLCSWRPWPDTLOCRSDRCWDWO;;c975c901-6cea-4b6f-8319-d67f45449506;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CIIO;CCDCLCSWRPWPDTLOCRSDRCWDWO;;f0f8ffac-1191-11d0-a060-00aa006c33ed;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CINPIO;RPWPLOSD;;e8b2aff2-59a7-4eac-9a70-819adef701dd;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;;RP;46a9b11d-60ae-405a-b7e8-ff8a58d456d2;;S-1-5-32-560)(OA;;RPWP;6db69a1c-9422-11d1-aebd-0000f80367c1;;S-1-5-32-561)(OA;;RPWP;5805bc62-bdc9-4428-a5e2-856a0f4c185e;;S-1-5-32-561)(OA;;LCRPLORC;;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;;LCRPLORC;;bf967aba-0de6-11d0-a285-00aa003049e2;RU)(OA;;CR;ab721a53-1e2f-11d0-9819-00aa0040529b;;WD)(OA;;CR;ab721a53-1e2f-11d0-9819-00aa0040529b;;PS)(OA;CI;RP;b1b3a417-ec55-4191-b327-b72e33e38af2;;NS)(OA;CI;RP;1f298a89-de98-47b8-b5cd-572ad53d267e;;AU)(OA;CI;RPWPCR;91e647de-d96f-4b70-9557-d63ff4f3ccd8;;PS)(A;;CCDCLCSWRPWPLOCRRCWDWO;;;DA)(A;;CCDCLCSWRPWPLOCRRCWDWO;;;S-1-5-21-4230534742-2542757381-3142984815-519)(A;CI;LCRPLORC;;;S-1-5-21-4230534742-2542757381-3142984815-1190)(A;CI;LCRPLORC;;;S-1-5-21-4230534742-2542757381-3142984815-1205)(A;;CCDCLCSWRPWPLOCRSDRCWDWO;;;BA)(A;;LCRPLORC;;;AU)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;SY)S:AI(AU;SA;WPWDWO;;;WD)(OU;CIIOIDSA;WP;f30e3bbe-9ff0-11d1-b603-0000f80367c1;bf967aa5-0de6-11d0-a285-00aa003049e2;WD)(OU;CIIOIDSA;WP;f30e3bbf-9ff0-11d1-b603-0000f80367c1;bf967aa5-0de6-11d0-a285-00aa003049e2;WD)(AU;CIIDSA;WPCRWDWO;;;WD)", "operationType": "%%14675"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-Security-Auditing", "providerGuid": "{54849625-5478-4994-a5ba-3e3b0328c30d}", "eventID": "5136", "version": "0", "level": "0", "task": "14081", "opcode": "0", "keywords": "0x8020000000000000", "systemTime": "2021-02-22T22:06:26.7928798Z", "eventRecordID": "111646767", "processID": "556", "threadID": "4060", "channel": "Security", "computer": "rootdc1.offsec.lan", "severityValue": "AUDIT_SUCCESS", "message": "A directory service object was modified.\n\t\nSubject:\n\tSecurity ID:\t\tS-1-5-21-4230534742-2542757381-3142984815-1111\n\tAccount Name:\t\tadmmig\n\tAccount Domain:\t\tOFFSEC\n\tLogon ID:\t\t0x24D81A03\n\nDirectory Service:\n\tName:\toffsec.lan\n\tType:\tActive Directory Domain Services\n\t\nObject:\n\tDN:\tCN=AdminSDHolder,CN=System,DC=offsec,DC=lan\n\tGUID:\t{dc8cdce1-2076-47c1-8ec2-3d0799cd324d}\n\tClass:\tcontainer\n\t\nAttribute:\n\tLDAP Display Name:\tnTSecurityDescriptor\n\tSyntax (OID):\t2.5.5.15\n\tValue:\tO:DAG:DAD:PAI(OD;CI;WP;f3a64788-5306-11d1-a9c5-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CIIO;CCDCLC;c975c901-6cea-4b6f-8319-d67f45449506;4828cc14-1437-45bc-9b07-ad6f015e5f28;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CIIO;CCDCLC;c975c901-6cea-4b6f-8319-d67f45449506;bf967aba-0de6-11d0-a285-00aa003049e2;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;;CR;1131f6ab-9c07-11d1-f79f-00c04fc2dcd2;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;;RPWP;bf967a7f-0de6-11d0-a285-00aa003049e2;;CA)(OA;CI;RP;4c164200-20c0-11d0-a768-00aa006e0529;;S-1-5-21-4230534742-2542757381-3142984815-1199)(OA;CI;RP;b1b3a417-ec55-4191-b327-b72e33e38af2;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;RP;9a7ad945-ca53-11d1-bbd0-0080c76670c0;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;RP;bf967a68-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;RP;1f298a89-de98-47b8-b5cd-572ad53d267e;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;RP;bf967991-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;RP;5fd424a1-1262-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;bf967a06-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;bf967a06-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;3e74f60e-3e73-11d1-a9c0-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;3e74f60e-3e73-11d1-a9c0-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;b1b3a417-ec55-4191-b327-b72e33e38af2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;b1b3a417-ec55-4191-b327-b72e33e38af2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;bf96791a-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;bf96791a-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;9a9a021e-4a5b-11d1-a9c3-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;934de926-b09e-11d2-aa06-00c04f8eedd8;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;5e353847-f36c-48be-a7f7-49685402503c;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;8d3bca50-1d7e-11d0-a081-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;bf967953-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;bf967953-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;e48d0154-bcf8-11d1-8702-00c04fb96050;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;275b2f54-982d-4dcd-b0ad-e53501445efb;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;bf967954-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;bf967954-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;bf967961-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;bf967961-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;5430e777-c3ea-4024-902e-dde192204669;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;6f606079-3a82-4c1b-8efb-dcc8c91d26fe;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;bf967a7f-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;614aea82-abc6-4dd0-a148-d67a59c72816;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;66437984-c3c5-498f-b269-987819ef484b;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;77b5b886-944a-11d1-aebd-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;a8df7489-c5ea-11d1-bbcb-0080c76670c0;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;a8df7489-c5ea-11d1-bbcb-0080c76670c0;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;1f298a89-de98-47b8-b5cd-572ad53d267e;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;1f298a89-de98-47b8-b5cd-572ad53d267e;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;f0f8ff9a-1191-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;f0f8ff9a-1191-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;f0f8ff9a-1191-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;2cc06e9d-6f7e-426a-8825-0215de176e11;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;5fd424a1-1262-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;5fd424a1-1262-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;3263e3b8-fd6b-4c60-87f2-34bdaa9d69eb;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;28630ebc-41d5-11d1-a9c1-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;28630ebc-41d5-11d1-a9c1-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;7cb4c7d3-8787-42b0-b438-3c5d479ad31e;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;CCDCLCRPWPLO;f0f8ffac-1191-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;CCDCLCRPWPLO;e8b2aff2-59a7-4eac-9a70-819adef701dd;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;CCDCLCSWRPWPDTLOCRSDRCWDWO;018849b0-a981-11d2-a9ff-00c04f8eedd8;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;CCDCLCSWRPWPDTLOCRSDRCWDWO;018849b0-a981-11d2-a9ff-00c04f8eedd8;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CIIO;CCDCLCSWRPWPDTLOCRSDRCWDWO;;c975c901-6cea-4b6f-8319-d67f45449506;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CIIO;CCDCLCSWRPWPDTLOCRSDRCWDWO;;f0f8ffac-1191-11d0-a060-00aa006c33ed;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CINPIO;RPWPLOSD;;e8b2aff2-59a7-4eac-9a70-819adef701dd;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;;RP;46a9b11d-60ae-405a-b7e8-ff8a58d456d2;;S-1-5-32-560)(OA;;RPWP;6db69a1c-9422-11d1-aebd-0000f80367c1;;S-1-5-32-561)(OA;;RPWP;5805bc62-bdc9-4428-a5e2-856a0f4c185e;;S-1-5-32-561)(OA;;CR;ab721a53-1e2f-11d0-9819-00aa0040529b;;WD)(OA;;CR;ab721a53-1e2f-11d0-9819-00aa0040529b;;PS)(OA;CI;RP;b1b3a417-ec55-4191-b327-b72e33e38af2;;NS)(OA;CI;RP;1f298a89-de98-47b8-b5cd-572ad53d267e;;AU)(OA;CI;RPWPCR;91e647de-d96f-4b70-9557-d63ff4f3ccd8;;PS)(A;;CCDCLCSWRPWPLOCRRCWDWO;;;DA)(A;;CCDCLCSWRPWPLOCRRCWDWO;;;S-1-5-21-4230534742-2542757381-3142984815-519)(A;CI;LCRPLORC;;;S-1-5-21-4230534742-2542757381-3142984815-1190)(A;CI;LCRPLORC;;;S-1-5-21-4230534742-2542757381-3142984815-1205)(A;CI;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-4230534742-2542757381-3142984815-1234)(OA;;LCRPLORC;;;RU)(A;;CCDCLCSWRPWPLOCRSDRCWDWO;;;BA)(A;;LCRPLORC;;;AU)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;SY)S:AI(AU;SA;WPWDWO;;;WD)(OU;CIIOIDSA;WP;f30e3bbe-9ff0-11d1-b603-0000f80367c1;bf967aa5-0de6-11d0-a285-00aa003049e2;WD)(OU;CIIOIDSA;WP;f30e3bbf-9ff0-11d1-b603-0000f80367c1;bf967aa5-0de6-11d0-a285-00aa003049e2;WD)(AU;CIIDSA;WPCRWDWO;;;WD)\n\t\nOperation:\n\tType:\tValue Added\n\tCorrelation ID:\t{9f6c1605-d0a4-4530-8624-8c2630d1cc21}\n\tApplication Correlation ID:\t-"}, "eventdata": {"opCorrelationID": "{9f6c1605-d0a4-4530-8624-8c2630d1cc21}", "subjectUserSid": "S-1-5-21-4230534742-2542757381-3142984815-1111", "subjectUserName": "admmig", "subjectDomainName": "OFFSEC", "subjectLogonId": "0x24d81a03", "dSName": "offsec.lan", "dSType": "%%14676", "objectDN": "CN=AdminSDHolder,CN=System,DC=offsec,DC=lan", "objectGUID": "{dc8cdce1-2076-47c1-8ec2-3d0799cd324d}", "objectClass": "container", "attributeLDAPDisplayName": "nTSecurityDescriptor", "attributeSyntaxOID": "2.5.5.15", "attributeValue": "O:DAG:DAD:PAI(OD;CI;WP;f3a64788-5306-11d1-a9c5-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CIIO;CCDCLC;c975c901-6cea-4b6f-8319-d67f45449506;4828cc14-1437-45bc-9b07-ad6f015e5f28;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CIIO;CCDCLC;c975c901-6cea-4b6f-8319-d67f45449506;bf967aba-0de6-11d0-a285-00aa003049e2;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;;CR;1131f6ab-9c07-11d1-f79f-00c04fc2dcd2;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;;RPWP;bf967a7f-0de6-11d0-a285-00aa003049e2;;CA)(OA;CI;RP;4c164200-20c0-11d0-a768-00aa006e0529;;S-1-5-21-4230534742-2542757381-3142984815-1199)(OA;CI;RP;b1b3a417-ec55-4191-b327-b72e33e38af2;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;RP;9a7ad945-ca53-11d1-bbd0-0080c76670c0;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;RP;bf967a68-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;RP;1f298a89-de98-47b8-b5cd-572ad53d267e;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;RP;bf967991-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;RP;5fd424a1-1262-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;bf967a06-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;bf967a06-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;3e74f60e-3e73-11d1-a9c0-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;3e74f60e-3e73-11d1-a9c0-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;b1b3a417-ec55-4191-b327-b72e33e38af2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;b1b3a417-ec55-4191-b327-b72e33e38af2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;bf96791a-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;bf96791a-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;9a9a021e-4a5b-11d1-a9c3-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;934de926-b09e-11d2-aa06-00c04f8eedd8;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;5e353847-f36c-48be-a7f7-49685402503c;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;8d3bca50-1d7e-11d0-a081-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;bf967953-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;bf967953-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;e48d0154-bcf8-11d1-8702-00c04fb96050;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;275b2f54-982d-4dcd-b0ad-e53501445efb;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;bf967954-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;bf967954-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;bf967961-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;bf967961-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;5430e777-c3ea-4024-902e-dde192204669;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;6f606079-3a82-4c1b-8efb-dcc8c91d26fe;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;bf967a7f-0de6-11d0-a285-00aa003049e2;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;614aea82-abc6-4dd0-a148-d67a59c72816;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;66437984-c3c5-498f-b269-987819ef484b;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;77b5b886-944a-11d1-aebd-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;a8df7489-c5ea-11d1-bbcb-0080c76670c0;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;a8df7489-c5ea-11d1-bbcb-0080c76670c0;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;1f298a89-de98-47b8-b5cd-572ad53d267e;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;1f298a89-de98-47b8-b5cd-572ad53d267e;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;f0f8ff9a-1191-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;f0f8ff9a-1191-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;f0f8ff9a-1191-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;2cc06e9d-6f7e-426a-8825-0215de176e11;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;5fd424a1-1262-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;5fd424a1-1262-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;3263e3b8-fd6b-4c60-87f2-34bdaa9d69eb;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;WP;28630ebc-41d5-11d1-a9c1-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;WP;28630ebc-41d5-11d1-a9c1-0000f80367c1;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;WP;7cb4c7d3-8787-42b0-b438-3c5d479ad31e;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;CCDCLCRPWPLO;f0f8ffac-1191-11d0-a060-00aa006c33ed;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CI;CCDCLCRPWPLO;e8b2aff2-59a7-4eac-9a70-819adef701dd;;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;CI;CCDCLCSWRPWPDTLOCRSDRCWDWO;018849b0-a981-11d2-a9ff-00c04f8eedd8;;S-1-5-21-4230534742-2542757381-3142984815-1190)(OA;CI;CCDCLCSWRPWPDTLOCRSDRCWDWO;018849b0-a981-11d2-a9ff-00c04f8eedd8;;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CIIO;CCDCLCSWRPWPDTLOCRSDRCWDWO;;c975c901-6cea-4b6f-8319-d67f45449506;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CIIO;CCDCLCSWRPWPDTLOCRSDRCWDWO;;f0f8ffac-1191-11d0-a060-00aa006c33ed;S-1-5-21-4230534742-2542757381-3142984815-1205)(OA;CINPIO;RPWPLOSD;;e8b2aff2-59a7-4eac-9a70-819adef701dd;S-1-5-21-4230534742-2542757381-3142984815-1204)(OA;;RP;46a9b11d-60ae-405a-b7e8-ff8a58d456d2;;S-1-5-32-560)(OA;;RPWP;6db69a1c-9422-11d1-aebd-0000f80367c1;;S-1-5-32-561)(OA;;RPWP;5805bc62-bdc9-4428-a5e2-856a0f4c185e;;S-1-5-32-561)(OA;;CR;ab721a53-1e2f-11d0-9819-00aa0040529b;;WD)(OA;;CR;ab721a53-1e2f-11d0-9819-00aa0040529b;;PS)(OA;CI;RP;b1b3a417-ec55-4191-b327-b72e33e38af2;;NS)(OA;CI;RP;1f298a89-de98-47b8-b5cd-572ad53d267e;;AU)(OA;CI;RPWPCR;91e647de-d96f-4b70-9557-d63ff4f3ccd8;;PS)(A;;CCDCLCSWRPWPLOCRRCWDWO;;;DA)(A;;CCDCLCSWRPWPLOCRRCWDWO;;;S-1-5-21-4230534742-2542757381-3142984815-519)(A;CI;LCRPLORC;;;S-1-5-21-4230534742-2542757381-3142984815-1190)(A;CI;LCRPLORC;;;S-1-5-21-4230534742-2542757381-3142984815-1205)(A;CI;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-4230534742-2542757381-3142984815-1234)(OA;;LCRPLORC;;;RU)(A;;CCDCLCSWRPWPLOCRSDRCWDWO;;;BA)(A;;LCRPLORC;;;AU)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;SY)S:AI(AU;SA;WPWDWO;;;WD)(OU;CIIOIDSA;WP;f30e3bbe-9ff0-11d1-b603-0000f80367c1;bf967aa5-0de6-11d0-a285-00aa003049e2;WD)(OU;CIIOIDSA;WP;f30e3bbf-9ff0-11d1-b603-0000f80367c1;bf967aa5-0de6-11d0-a285-00aa003049e2;WD)(AU;CIIDSA;WPCRWDWO;;;WD)", "operationType": "%%14674"}}}'''
        ]

        responses = send_multiple_logs(logs, location="stdin", log_format="json")

        # Ensure we receive a response for each log sent
        self.assertEqual(len(responses), len(logs))

        for _, response in enumerate(responses):
            self.assertEqual(response.status, LogtestStatus.RuleMatch)
            self.assertEqual(response.decoder, 'json')

            # Example: Set expected Wazuh rule ID and level when analyzing logs
            # expected_rule_id = None  # Replace with actual rule ID
            # expected_rule_level = None  # Replace with actual rule level

            # self.assertEqual(response.rule_id, expected_rule_id)
            # self.assertEqual(response.rule_level, expected_rule_level)

        # TODO: Write the expected result as test cases when the logs are analyzed by Wazuh.
        self.fail("Test not implemented yet. Define expected results.")

    def test_id800_4103_4104_wmi_registration_via_powerlurk(self) -> None:
        # Logs extracted from EVTX file
        logs = [
            r'''{"win": {"system": {"providerName": "PowerShell", "providerGuid": {"@Name": "PowerShell"}, "eventID": "800", "level": "4", "task": "8", "keywords": "0x80000000000000", "systemTime": "2021-06-10T14:12:46.041829000Z", "eventRecordID": "28810", "channel": "Windows PowerShell", "computer": "fs01.offsec.lan", "severityValue": "INFORMATION", "message": "Pipeline execution details for command line: \tDetailSequence=1\n\tDetailTotal=1\n\n\tSequenceNumber=289\n\n\tUserId=OFFSEC\\admmig\n\tHostName=ConsoleHost\n\tHostVersion=5.1.14393.3383\n\tHostId=cebe54d1-4235-4f11-9fd4-5319a4253d0e\n\tHostApplication=C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\n\tEngineVersion=5.1.14393.3383\n\tRunspaceId=147302b5-06ec-4bbb-a604-7772a0f40632\n\tPipelineId=68\n\tScriptName=\n\tCommandLine=. \n\nContext Information: \nCommandInvocation(PSConsoleHostReadline): \"PSConsoleHostReadline\"\n \n\nDetails: \n%3"}, "eventdata": {}}}''',
            r'''{"win": {"system": {"providerName": "PowerShell", "providerGuid": {"@Name": "PowerShell"}, "eventID": "800", "level": "4", "task": "8", "keywords": "0x80000000000000", "systemTime": "2021-06-10T14:12:46.151734500Z", "eventRecordID": "28811", "channel": "Windows PowerShell", "computer": "fs01.offsec.lan", "severityValue": "INFORMATION", "message": "Pipeline execution details for command line:             $Consumer = Set-WmiInstance -Namespace root/subscription -Class CommandLineEventConsumer -Arguments $CommandConsumerArgs @Arguments\n. \n\nContext Information: \n\tDetailSequence=1\n\tDetailTotal=1\n\n\tSequenceNumber=291\n\n\tUserId=OFFSEC\\admmig\n\tHostName=ConsoleHost\n\tHostVersion=5.1.14393.3383\n\tHostId=cebe54d1-4235-4f11-9fd4-5319a4253d0e\n\tHostApplication=C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\n\tEngineVersion=5.1.14393.3383\n\tRunspaceId=147302b5-06ec-4bbb-a604-7772a0f40632\n\tPipelineId=69\n\tScriptName=C:\\Users\\admmig\\Desktop\\powerlurk.ps1\n\tCommandLine=            $Consumer = Set-WmiInstance -Namespace root/subscription -Class CommandLineEventConsumer -Arguments $CommandConsumerArgs @Arguments\n \n\nDetails: \nCommandInvocation(Set-WmiInstance): \"Set-WmiInstance\"\nParameterBinding(Set-WmiInstance): name=\"Namespace\"; value=\"root/subscription\"\nParameterBinding(Set-WmiInstance): name=\"Class\"; value=\"CommandLineEventConsumer\"\nParameterBinding(Set-WmiInstance): name=\"Arguments\"; value=\"System.Collections.Hashtable\""}, "eventdata": {}}}''',
            r'''{"win": {"system": {"providerName": "PowerShell", "providerGuid": {"@Name": "PowerShell"}, "eventID": "800", "level": "4", "task": "8", "keywords": "0x80000000000000", "systemTime": "2021-06-10T14:12:46.167370500Z", "eventRecordID": "28812", "channel": "Windows PowerShell", "computer": "fs01.offsec.lan", "severityValue": "INFORMATION", "message": "Pipeline execution details for command line:             $Filter = Set-WmiInstance -Namespace root/subscription -Class __EventFilter -Arguments $EventFilterArgs @Arguments\n. \n\nContext Information: \n\tDetailSequence=1\n\tDetailTotal=1\n\n\tSequenceNumber=293\n\n\tUserId=OFFSEC\\admmig\n\tHostName=ConsoleHost\n\tHostVersion=5.1.14393.3383\n\tHostId=cebe54d1-4235-4f11-9fd4-5319a4253d0e\n\tHostApplication=C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\n\tEngineVersion=5.1.14393.3383\n\tRunspaceId=147302b5-06ec-4bbb-a604-7772a0f40632\n\tPipelineId=69\n\tScriptName=C:\\Users\\admmig\\Desktop\\powerlurk.ps1\n\tCommandLine=            $Filter = Set-WmiInstance -Namespace root/subscription -Class __EventFilter -Arguments $EventFilterArgs @Arguments\n \n\nDetails: \nCommandInvocation(Set-WmiInstance): \"Set-WmiInstance\"\nParameterBinding(Set-WmiInstance): name=\"Namespace\"; value=\"root/subscription\"\nParameterBinding(Set-WmiInstance): name=\"Class\"; value=\"__EventFilter\"\nParameterBinding(Set-WmiInstance): name=\"Arguments\"; value=\"System.Collections.Hashtable\""}, "eventdata": {}}}''',
            r'''{"win": {"system": {"providerName": "PowerShell", "providerGuid": {"@Name": "PowerShell"}, "eventID": "800", "level": "4", "task": "8", "keywords": "0x80000000000000", "systemTime": "2021-06-10T14:12:46.198620000Z", "eventRecordID": "28813", "channel": "Windows PowerShell", "computer": "fs01.offsec.lan", "severityValue": "INFORMATION", "message": "Pipeline execution details for command line:             Set-WmiInstance -Namespace root/subscription -Class __FilterToConsumerBinding -Arguments $FilterToConsumerArgs @Arguments | Out-Null\n. \n\nContext Information: \n\tDetailSequence=1\n\tDetailTotal=1\n\n\tSequenceNumber=295\n\n\tUserId=OFFSEC\\admmig\n\tHostName=ConsoleHost\n\tHostVersion=5.1.14393.3383\n\tHostId=cebe54d1-4235-4f11-9fd4-5319a4253d0e\n\tHostApplication=C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\n\tEngineVersion=5.1.14393.3383\n\tRunspaceId=147302b5-06ec-4bbb-a604-7772a0f40632\n\tPipelineId=69\n\tScriptName=C:\\Users\\admmig\\Desktop\\powerlurk.ps1\n\tCommandLine=            Set-WmiInstance -Namespace root/subscription -Class __FilterToConsumerBinding -Arguments $FilterToConsumerArgs @Arguments | Out-Null\n \n\nDetails: \nCommandInvocation(Set-WmiInstance): \"Set-WmiInstance\"\nParameterBinding(Set-WmiInstance): name=\"Namespace\"; value=\"root/subscription\"\nParameterBinding(Set-WmiInstance): name=\"Class\"; value=\"__FilterToConsumerBinding\"\nParameterBinding(Set-WmiInstance): name=\"Arguments\"; value=\"System.Collections.Hashtable\"\nCommandInvocation(Out-Null): \"Out-Null\"\nParameterBinding(Out-Null): name=\"InputObject\"; value=\"__FilterToConsumerBinding.Consumer=\"CommandLineEventConsumer.Name=\\\"Evil23\\\"\",Filter=\"__EventFilter.Name=\\\"Evil23\\\"\"\""}, "eventdata": {}}}''',
            r'''{"win": {"system": {"providerName": "PowerShell", "providerGuid": {"@Name": "PowerShell"}, "eventID": "800", "level": "4", "task": "8", "keywords": "0x80000000000000", "systemTime": "2021-06-10T14:12:46.198620000Z", "eventRecordID": "28814", "channel": "Windows PowerShell", "computer": "fs01.offsec.lan", "severityValue": "INFORMATION", "message": "Pipeline execution details for command line: \tDetailSequence=1\n\tDetailTotal=1\n\n\tSequenceNumber=297\n\n\tUserId=OFFSEC\\admmig\n\tHostName=ConsoleHost\n\tHostVersion=5.1.14393.3383\n\tHostId=cebe54d1-4235-4f11-9fd4-5319a4253d0e\n\tHostApplication=C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\n\tEngineVersion=5.1.14393.3383\n\tRunspaceId=147302b5-06ec-4bbb-a604-7772a0f40632\n\tPipelineId=69\n\tScriptName=\n\tCommandLine=. \n\nContext Information: \nCommandInvocation(Out-Default): \"Out-Default\"\n \n\nDetails: \n%3"}, "eventdata": {}}}''',
            r'''{"win": {"system": {"providerName": "PowerShell", "providerGuid": {"@Name": "PowerShell"}, "eventID": "800", "level": "4", "task": "8", "keywords": "0x80000000000000", "systemTime": "2021-06-10T14:12:46.214251300Z", "eventRecordID": "28815", "channel": "Windows PowerShell", "computer": "fs01.offsec.lan", "severityValue": "INFORMATION", "message": "Pipeline execution details for command line:     Microsoft.PowerShell.Core\\Set-StrictMode -Off\n. \n\nContext Information: \n\tDetailSequence=1\n\tDetailTotal=1\n\n\tSequenceNumber=299\n\n\tUserId=OFFSEC\\admmig\n\tHostName=ConsoleHost\n\tHostVersion=5.1.14393.3383\n\tHostId=cebe54d1-4235-4f11-9fd4-5319a4253d0e\n\tHostApplication=C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\n\tEngineVersion=5.1.14393.3383\n\tRunspaceId=147302b5-06ec-4bbb-a604-7772a0f40632\n\tPipelineId=71\n\tScriptName=C:\\Program Files\\WindowsPowerShell\\Modules\\PSReadline\\1.2\\PSReadLine.psm1\n\tCommandLine=    Microsoft.PowerShell.Core\\Set-StrictMode -Off\n \n\nDetails: \nCommandInvocation(Set-StrictMode): \"Set-StrictMode\"\nParameterBinding(Set-StrictMode): name=\"Off\"; value=\"True\""}, "eventdata": {}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-PowerShell", "providerGuid": "{A0C1853B-5C40-4B15-8766-3CF1C58F985A}", "eventID": "4103", "version": "1", "level": "4", "task": "106", "opcode": "20", "keywords": "0x0", "systemTime": "2021-06-10T14:12:46.042899300Z", "eventRecordID": "30203", "processID": "2096", "threadID": "5848", "channel": "Microsoft-Windows-PowerShell/Operational", "computer": "fs01.offsec.lan", "severityValue": "INFORMATION", "message": "%3\n\nContext:\n%1\n\nUser Data:\n%2"}, "eventdata": {"contextInfo": "Severity = Informational\n        Host Name = ConsoleHost\n        Host Version = 5.1.14393.3383\n        Host ID = cebe54d1-4235-4f11-9fd4-5319a4253d0e\n        Host Application = C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\n        Engine Version = 5.1.14393.3383\n        Runspace ID = 147302b5-06ec-4bbb-a604-7772a0f40632\n        Pipeline ID = 68\n        Command Name = PSConsoleHostReadline\n        Command Type = Function\n        Script Name = \n        Command Path = \n        Sequence Number = 290\n        User = OFFSEC\\admmig\n        Connected User = \n        Shell ID = Microsoft.PowerShell", "payload": "CommandInvocation(PSConsoleHostReadline): \"PSConsoleHostReadline\""}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-PowerShell", "providerGuid": "{A0C1853B-5C40-4B15-8766-3CF1C58F985A}", "eventID": "4104", "version": "1", "level": "5", "task": "2", "opcode": "15", "keywords": "0x0", "systemTime": "2021-06-10T14:12:46.058429500Z", "eventRecordID": "30204", "processID": "2096", "threadID": "5848", "channel": "Microsoft-Windows-PowerShell/Operational", "computer": "fs01.offsec.lan", "severityValue": "VERBOSE", "message": "Creating Scriptblock text (1 of 1):\nRegister-MaliciousWmiEvent -EventName Evil23 -PermanentCommand \"cmd.exe /c echo %ProcessId% >> c:\\\\temp\\\\log.txt\" -Trigger ProcessStart -ProcessName notepad.exe\n\nScriptBlock ID: e0e50dd9-152a-4e73-abef-d419adf732e6\nPath: %5"}, "eventdata": {"messageNumber": "1", "messageTotal": "1", "scriptBlockText": "Register-MaliciousWmiEvent -EventName Evil23 -PermanentCommand \"cmd.exe /c echo %ProcessId% >> c:\\\\temp\\\\log.txt\" -Trigger ProcessStart -ProcessName notepad.exe", "scriptBlockId": "e0e50dd9-152a-4e73-abef-d419adf732e6"}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-PowerShell", "providerGuid": "{A0C1853B-5C40-4B15-8766-3CF1C58F985A}", "eventID": "4103", "version": "1", "level": "4", "task": "106", "opcode": "20", "keywords": "0x0", "systemTime": "2021-06-10T14:12:46.157099000Z", "eventRecordID": "30205", "processID": "2096", "threadID": "5848", "channel": "Microsoft-Windows-PowerShell/Operational", "computer": "fs01.offsec.lan", "severityValue": "INFORMATION", "message": "%3\n\nContext:\n%1\n\nUser Data:\n%2"}, "eventdata": {"contextInfo": "Severity = Informational\n        Host Name = ConsoleHost\n        Host Version = 5.1.14393.3383\n        Host ID = cebe54d1-4235-4f11-9fd4-5319a4253d0e\n        Host Application = C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\n        Engine Version = 5.1.14393.3383\n        Runspace ID = 147302b5-06ec-4bbb-a604-7772a0f40632\n        Pipeline ID = 69\n        Command Name = Set-WmiInstance\n        Command Type = Cmdlet\n        Script Name = C:\\Users\\admmig\\Desktop\\powerlurk.ps1\n        Command Path = \n        Sequence Number = 292\n        User = OFFSEC\\admmig\n        Connected User = \n        Shell ID = Microsoft.PowerShell", "payload": "CommandInvocation(Set-WmiInstance): \"Set-WmiInstance\"\nParameterBinding(Set-WmiInstance): name=\"Namespace\"; value=\"root/subscription\"\nParameterBinding(Set-WmiInstance): name=\"Class\"; value=\"CommandLineEventConsumer\"\nParameterBinding(Set-WmiInstance): name=\"Arguments\"; value=\"System.Collections.Hashtable\""}}}''',
            r'''{"win": {"system": {"providerName": "Microsoft-Windows-PowerShell", "providerGuid": "{A0C1853B-5C40-4B15-8766-3CF1C58F985A}", "eventID": "4103", "version": "1", "level": "4", "task": "106", "opcode": "20", "keywords": "0x0", "systemTime": "2021-06-10T14:12:46.177246300Z", "eventRecordID": "30206", "processID": "2096", "threadID": "5848", "channel": "Microsoft-Windows-PowerShell/Operational", "computer": "fs01.offsec.lan", "severityValue": "INFORMATION", "message": "%3\n\nContext:\n%1\n\nUser Data:\n%2"}, "eventdata": {"contextInfo": "Severity = Informational\n        Host Name = ConsoleHost\n        Host Version = 5.1.14393.3383\n        Host ID = cebe54d1-4235-4f11-9fd4-5319a4253d0e\n        Host Application = C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\n        Engine Version = 5.1.14393.3383\n        Runspace ID = 147302b5-06ec-4bbb-a604-7772a0f40632\n        Pipeline ID = 69\n        Command Name = Set-WmiInstance\n        Command Type = Cmdlet\n        Script Name = C:\\Users\\admmig\\Desktop\\powerlurk.ps1\n        Command Path = \n        Sequence Number = 294\n        User = OFFSEC\\admmig\n        Connected User = \n        Shell ID = Microsoft.PowerShell", "payload": "CommandInvocation(Set-WmiInstance): \"Set-WmiInstance\"\nParameterBinding(Set-WmiInstance): name=\"Namespace\"; value=\"root/subscription\"\nParameterBinding(Set-WmiInstance): name=\"Class\"; value=\"__EventFilter\"\nParameterBinding(Set-WmiInstance): name=\"Arguments\"; value=\"System.Collections.Hashtable\""}}}'''
        ]

        responses = send_multiple_logs(logs, location="stdin", log_format="json")

        # Ensure we receive a response for each log sent
        self.assertEqual(len(responses), len(logs))

        for _, response in enumerate(responses):
            self.assertEqual(response.status, LogtestStatus.RuleMatch)
            self.assertEqual(response.decoder, 'json')

            # Example: Set expected Wazuh rule ID and level when analyzing logs
            # expected_rule_id = None  # Replace with actual rule ID
            # expected_rule_level = None  # Replace with actual rule level

            # self.assertEqual(response.rule_id, expected_rule_id)
            # self.assertEqual(response.rule_level, expected_rule_level)

        # TODO: Write the expected result as test cases when the logs are analyzed by Wazuh.
        self.fail("Test not implemented yet. Define expected results.")
